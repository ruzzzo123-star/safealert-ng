<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>SafeAlert NG</title>
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="Emergency safety app for Nigeria. SOS alerts, trip monitoring, incident reporting.">
  <meta name="theme-color" content="#FF375F">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="SafeAlert">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="msapplication-tap-highlight" content="no">
  
  <!-- Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%23000' width='180' height='180' rx='40'/><text x='90' y='115' text-anchor='middle' font-size='80'>üõ°Ô∏è</text></svg>">
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect fill='%23000' width='32' height='32' rx='6'/><text x='16' y='22' text-anchor='middle' font-size='18'>üõ°Ô∏è</text></svg>">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    /* Smooth transitions for responsive scaling */
    .app, .screen, #sosBtn, .quick-action, .safety, .incident-type, 
    .nav-item, .end-emergency-btn, .page-title {
      transition: all 0.2s ease;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
      background: #000;
      color: #fff;
      min-height: 100vh;
      overflow-x: hidden;
    }
    
    .app {
      max-width: 430px;
      margin: 0 auto;
      min-height: 100vh;
      position: relative;
    }
    
    /* =============================================
       RESPONSIVE DESIGN
       ============================================= */
    
    /* Small phones - iPhone SE, budget phones (< 375px) */
    @media (max-width: 374px) {
      .screen { padding: 16px; padding-bottom: 90px; }
      .page-title { font-size: 24px; }
      .island { width: 110px; height: 34px; }
      .island.expanded { width: calc(100% - 32px); height: 70px; }
      
      #sosBtn { width: 140px; height: 140px; }
      .sos-count { font-size: 38px !important; }
      .sos-label { font-size: 10px !important; }
      .sos-ring { width: 170px; height: 170px; }
      
      .quick-actions { gap: 8px; }
      .quick-action { padding: 12px 8px; }
      .quick-action-icon { width: 40px; height: 40px; font-size: 18px; }
      .quick-action-label { font-size: 10px; }
      
      .safety { padding: 14px; }
      .safety-icon { width: 44px; height: 44px; font-size: 20px; }
      .safety-title { font-size: 15px; }
      .safety-sub { font-size: 12px; }
      
      .incident-types { grid-template-columns: repeat(3, 1fr); gap: 6px; }
      .incident-type { padding: 10px 6px; }
      .incident-icon { font-size: 22px; }
      .incident-label { font-size: 9px; }
      
      .duration-grid { grid-template-columns: repeat(4, 1fr); gap: 6px; }
      .duration-value { font-size: 22px; }
      
      .nav-item { font-size: 9px; }
      .nav-item span:first-child { font-size: 20px; }
      
      .end-emergency-btn { padding: 14px 20px; font-size: 14px; }
      
      .timer-time { font-size: 42px; }
      .timer-ring { width: 180px; height: 180px; }
      .timer-ring svg { width: 180px; height: 180px; }
      
      .recording-timer { font-size: 52px; }
    }
    
    /* Nigerian popular phones - Tecno, Infinix, Samsung A (360-400px) */
    @media (min-width: 375px) and (max-width: 400px) {
      .screen { padding: 18px; }
      #sosBtn { width: 150px; height: 150px; }
      .sos-ring { width: 180px; height: 180px; }
      .incident-types { gap: 8px; }
    }
    
    /* Standard phones - iPhone, high-end Android (400-430px) */
    @media (min-width: 401px) and (max-width: 430px) {
      /* Default styles - no changes needed */
    }
    
    /* Large phones / Small tablets (431-600px) */
    @media (min-width: 431px) and (max-width: 600px) {
      .app { max-width: 500px; }
      .screen { padding: 24px; padding-bottom: 100px; }
      
      #sosBtn { width: 180px; height: 180px; }
      .sos-count { font-size: 52px !important; }
      .sos-ring { width: 210px; height: 210px; }
      
      .quick-action-icon { width: 56px; height: 56px; font-size: 26px; }
      .quick-action-label { font-size: 13px; }
      
      .page-title { font-size: 32px; }
      .safety { padding: 20px; }
      .safety-icon { width: 56px; height: 56px; font-size: 26px; }
      
      .incident-types { gap: 12px; }
      .incident-type { padding: 18px 12px; }
      .incident-icon { font-size: 32px; }
      .incident-label { font-size: 12px; }
    }
    
    /* Tablets (601-1023px) */
    @media (min-width: 601px) and (max-width: 1023px) {
      body { background: #111; }
      
      .app { 
        max-width: 600px; 
        background: #000;
        box-shadow: 0 0 60px rgba(0,0,0,0.5);
      }
      
      .screen { padding: 30px; padding-bottom: 110px; }
      
      #sosBtn { width: 200px; height: 200px; }
      .sos-count { font-size: 56px !important; }
      .sos-ring { width: 240px; height: 240px; }
      
      .page-title { font-size: 36px; }
      
      .quick-actions { gap: 16px; }
      .quick-action { padding: 20px 16px; border-radius: 20px; }
      .quick-action-icon { width: 60px; height: 60px; font-size: 28px; }
      .quick-action-label { font-size: 14px; }
      
      .safety { padding: 24px; border-radius: 24px; }
      .safety-icon { width: 64px; height: 64px; font-size: 30px; }
      .safety-title { font-size: 20px; }
      .safety-sub { font-size: 15px; }
      
      .incident-types { grid-template-columns: repeat(4, 1fr); gap: 14px; }
      .incident-type { padding: 20px 14px; border-radius: 20px; }
      .incident-icon { font-size: 36px; }
      .incident-label { font-size: 13px; }
      
      .nav-item { padding: 14px 8px; }
      .nav-item span:first-child { font-size: 26px; }
      .nav-item span:last-child { font-size: 11px; }
      
      .timer-time { font-size: 64px; }
      .timer-ring { width: 260px; height: 260px; }
      .timer-ring svg { width: 260px; height: 260px; }
      
      .recording-timer { font-size: 80px; }
      .waveform { height: 100px; }
      .wave-bar { width: 8px; }
    }
    
    /* Desktop (1024px+) */
    @media (min-width: 1024px) {
      body { 
        background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
      }
      
      .app { 
        max-width: 430px;
        height: 90vh;
        max-height: 932px;
        border-radius: 40px;
        overflow: hidden;
        box-shadow: 
          0 0 0 12px #1a1a1a,
          0 0 0 14px #333,
          0 30px 80px rgba(0,0,0,0.6);
        position: relative;
      }
      
      /* Phone frame notch */
      .app::before {
        content: '';
        position: absolute;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 150px;
        height: 34px;
        background: #1a1a1a;
        border-radius: 0 0 20px 20px;
        z-index: 1000;
      }
      
      .screen { 
        height: 100%;
        overflow-y: auto;
        padding-top: 50px;
      }
      
      .status-bar {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        z-index: 999;
        background: #000;
        padding-top: 8px;
      }
      
      /* Hover states for desktop */
      .quick-action:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 30px rgba(0,0,0,0.3);
      }
      
      .incident-type:hover {
        transform: translateY(-2px);
        border-color: rgba(255,255,255,0.1);
      }
      
      .nav-item:hover {
        background: rgba(255,255,255,0.05);
      }
      
      #sosBtn:hover {
        transform: scale(1.03);
        box-shadow: 0 15px 50px rgba(255,55,95,0.5);
      }
      
      .end-emergency-btn:hover {
        transform: scale(1.02);
        box-shadow: 0 12px 40px rgba(50,215,75,0.5);
      }
    }
    
    /* Ultra-wide desktop - show side panels */
    @media (min-width: 1400px) {
      body {
        background: linear-gradient(135deg, #0f0f0f 0%, #000 100%);
      }
      
      .app {
        position: relative;
      }
      
      /* Left info panel */
      .app::after {
        content: 'SafeAlert NG ‚Äî Emergency Response App for Nigeria';
        position: absolute;
        left: -320px;
        top: 50%;
        transform: translateY(-50%);
        width: 280px;
        padding: 30px;
        background: rgba(255,255,255,0.02);
        border: 1px solid rgba(255,255,255,0.05);
        border-radius: 20px;
        color: #666;
        font-size: 14px;
        line-height: 1.6;
        text-align: center;
      }
    }
    
    /* Additional responsive fixes for specific components */
    @media (max-width: 374px) {
      .emergency-hotlines { padding: 10px 12px; }
      .hotline-btn { padding: 8px; font-size: 12px; }
      .hotline-btn.nscdc { font-size: 10px; }
      
      .severity-options { gap: 6px; }
      .severity-option { padding: 10px 6px; font-size: 11px; }
      .severity-dot { width: 10px; height: 10px; }
      
      .location-current { padding: 12px; }
      .location-icon { font-size: 20px; }
      .location-label { font-size: 13px; }
      
      .report-description { font-size: 14px; }
      .evidence-attach { gap: 6px; }
      .evidence-option { padding: 10px; font-size: 10px; }
      
      .submitted-card { padding: 12px; }
      .submitted-type-icon { font-size: 26px; }
      .submitted-type { font-size: 14px; }
      
      .hub-toggle { gap: 6px; }
      .hub-tab { padding: 10px 16px; font-size: 12px; }
      
      .alert-card { padding: 12px; }
      .alert-icon { width: 40px; height: 40px; font-size: 18px; }
      
      .trip-panel { padding: 16px; }
      .trip-dest-item { padding: 10px; }
    }
    
    @media (min-width: 601px) {
      .emergency-hotlines { padding: 18px 20px; }
      .hotline-btn { padding: 14px; font-size: 16px; }
      
      .location-current { padding: 18px 20px; border-radius: 18px; }
      .report-description { font-size: 16px; padding: 18px; }
      
      .evidence-option { padding: 18px; border-radius: 18px; }
      .evidence-option span:first-child { font-size: 28px; }
      
      .anonymous-toggle { padding: 18px 20px; }
      .report-submit-btn { padding: 20px; font-size: 20px; border-radius: 20px; }
      
      .hub-tab { padding: 14px 28px; font-size: 15px; }
      .alert-card { padding: 18px; border-radius: 20px; }
    }
    
    /* Screens */
    .screen {
      display: none;
      padding: 20px;
      padding-bottom: 100px;
      min-height: 100vh;
    }
    
    .screen.active {
      display: block;
    }
    
    /* Full screen for map */
    .screen.fullscreen {
      padding: 0;
      padding-bottom: 80px;
    }
    
    /* Ambient Glow */
    .glow {
      position: fixed;
      top: -100px;
      right: -100px;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(50,215,75,0.3) 0%, transparent 70%);
      pointer-events: none;
      opacity: 0.5;
      transition: all 0.5s ease;
      z-index: 0;
    }
    
    .glow.danger {
      background: radial-gradient(circle, rgba(255,55,95,0.4) 0%, transparent 70%);
      opacity: 0.8;
      animation: pulse-glow 1s infinite;
    }
    
    @keyframes pulse-glow {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }
    
    /* Status Bar */
    .status-bar {
      display: flex;
      justify-content: space-between;
      padding: 14px 20px;
      font-size: 14px;
      font-weight: 600;
    }
    
    /* Dynamic Island */
    .island {
      width: 126px;
      height: 37px;
      background: #1a1a1a;
      border-radius: 20px;
      margin: 0 auto 20px;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    
    .island.expanded {
      width: calc(100% - 40px);
      height: 76px;
      border-radius: 24px;
      background: linear-gradient(135deg, rgba(255,55,95,0.25), rgba(255,55,95,0.1));
      border: 1px solid rgba(255,55,95,0.3);
    }
    
    .island.trip-active {
      width: calc(100% - 40px);
      height: 76px;
      border-radius: 24px;
      background: linear-gradient(135deg, rgba(100,210,255,0.25), rgba(100,210,255,0.1));
      border: 1px solid rgba(100,210,255,0.3);
    }
    
    .island-content {
      display: none;
      align-items: center;
      gap: 14px;
      padding: 0 20px;
      width: 100%;
    }
    
    .island.expanded .island-content,
    .island.trip-active .island-content {
      display: flex;
    }
    
    .island-icon {
      width: 44px;
      height: 44px;
      background: #FF375F;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }
    
    .island.trip-active .island-icon {
      background: #64D2FF;
    }
    
    .island-title { font-weight: 700; color: #FF375F; }
    .island.trip-active .island-title { color: #64D2FF; }
    .island-sub { font-size: 12px; color: #8E8E93; }
    
    /* Header */
    .header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 20px;
    }
    
    .logo {
      width: 48px;
      height: 48px;
      background: linear-gradient(145deg, #FF375F, #c41e3a);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      box-shadow: 0 4px 20px rgba(255,55,95,0.3);
    }
    
    .header h1 { font-size: 24px; }
    .header p { color: #8E8E93; font-size: 13px; }
    
    /* Location Banner */
    .location {
      display: flex;
      align-items: center;
      gap: 12px;
      background: #1C1C1E;
      border-radius: 16px;
      padding: 14px 16px;
      margin-bottom: 16px;
      border: 1px solid rgba(255,255,255,0.06);
    }
    
    .location-icon {
      width: 40px;
      height: 40px;
      background: rgba(100,210,255,0.15);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    .location-text { flex: 1; }
    .location-city { font-weight: 600; font-size: 15px; }
    .location-state { font-size: 12px; color: #8E8E93; }
    .location-change { color: #64D2FF; font-size: 13px; cursor: pointer; }
    
    /* Safety Card */
    .safety {
      background: linear-gradient(135deg, rgba(50,215,75,0.15), rgba(50,215,75,0.05));
      border: 1px solid rgba(50,215,75,0.3);
      border-radius: 20px;
      padding: 18px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 14px;
      transition: all 0.3s;
    }
    
    .safety.danger {
      background: linear-gradient(135deg, rgba(255,55,95,0.2), rgba(255,55,95,0.05));
      border-color: rgba(255,55,95,0.4);
    }
    
    .safety-icon {
      width: 52px;
      height: 52px;
      background: linear-gradient(145deg, #32D74B, #28a745);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      box-shadow: 0 0 20px rgba(50,215,75,0.3);
    }
    
    .safety.danger .safety-icon {
      background: linear-gradient(145deg, #FF375F, #c41e3a);
      box-shadow: 0 0 20px rgba(255,55,95,0.4);
    }
    
    .safety-title { font-size: 17px; font-weight: 700; }
    .safety-sub { font-size: 12px; color: #8E8E93; margin-top: 3px; }
    
    .safety-badge {
      display: inline-block;
      margin-top: 6px;
      padding: 5px 10px;
      background: rgba(50,215,75,0.15);
      border-radius: 10px;
      font-size: 11px;
      font-weight: 600;
      color: #32D74B;
    }
    
    .safety.danger .safety-badge {
      background: rgba(255,55,95,0.15);
      color: #FF375F;
    }
    
    /* SOS Button */
    .sos-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px 0 24px;
    }
    
    .sos-outer {
      position: relative;
      width: 200px;
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .sos-ring {
      position: absolute;
      width: 100%;
      height: 100%;
      border: 2px dashed rgba(255,55,95,0.2);
      border-radius: 50%;
      animation: spin 20s linear infinite;
    }
    
    @keyframes spin { to { transform: rotate(360deg); } }
    
    #sosBtn {
      width: 160px;
      height: 160px;
      border-radius: 50%;
      background: linear-gradient(145deg, #FF375F, #c41e3a, #9b1b30);
      border: none;
      color: white;
      cursor: pointer;
      box-shadow: 0 10px 40px rgba(255,55,95,0.4);
      transition: transform 0.2s, box-shadow 0.2s;
      -webkit-user-select: none;
      user-select: none;
      touch-action: none;
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    #sosBtn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      animation: shimmer 3s infinite;
    }
    
    @keyframes shimmer { 0% { left: -100%; } 100% { left: 100%; } }
    
    .sos-count {
      font-size: 44px;
      font-weight: 800;
      line-height: 1;
      position: relative;
      z-index: 1;
    }
    
    .sos-label {
      display: block;
      font-size: 11px;
      font-weight: 500;
      margin-top: 6px;
      position: relative;
      z-index: 1;
      opacity: 0.9;
    }
    
    #sosBtn.holding {
      transform: scale(0.92);
      box-shadow: 0 5px 30px rgba(255,55,95,0.6);
    }
    
    #sosBtn.holding .sos-count {
      font-size: 64px;
      animation: pulse-count 0.5s infinite;
    }
    
    @keyframes pulse-count {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    /* End Emergency Button */
    .end-emergency-btn {
      width: 100%;
      max-width: 280px;
      margin: 20px auto 0;
      padding: 16px 24px;
      background: linear-gradient(135deg, #32D74B, #28a745);
      border: none;
      border-radius: 30px;
      color: #fff;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 8px 30px rgba(50,215,75,0.4);
      animation: pulse-safe 1.5s infinite;
    }
    
    .end-emergency-btn:active {
      transform: scale(0.97);
    }
    
    @keyframes pulse-safe {
      0%, 100% { box-shadow: 0 8px 30px rgba(50,215,75,0.3); }
      50% { box-shadow: 0 8px 50px rgba(50,215,75,0.6); }
    }
    
    .end-emergency-btn span:first-child {
      font-size: 20px;
    }

    /* Quick Actions */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 24px;
    }
    
    .quick-action {
      background: #1C1C1E;
      border-radius: 16px;
      padding: 14px 8px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.06);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .quick-action:active {
      transform: scale(0.95);
    }
    
    .quick-action-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      margin: 0 auto 8px;
    }
    
    .quick-action-label {
      font-size: 11px;
      color: #8E8E93;
      font-weight: 500;
    }
    
    /* Section Header */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 20px 0 12px;
    }
    
    .section-title {
      color: #8E8E93;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 600;
    }
    
    .section-action {
      color: #64D2FF;
      font-size: 14px;
      cursor: pointer;
    }
    
    /* Contacts */
    .contact {
      display: flex;
      align-items: center;
      gap: 12px;
      background: #1C1C1E;
      border-radius: 16px;
      padding: 12px 14px;
      margin-bottom: 10px;
      border: 1px solid rgba(255,255,255,0.06);
    }
    
    .contact-avatar {
      position: relative;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 15px;
    }
    
    .contact-status {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 12px;
      height: 12px;
      background: #32D74B;
      border: 2px solid #1C1C1E;
      border-radius: 50%;
    }
    
    .contact-info { flex: 1; }
    .contact-name { font-weight: 600; font-size: 15px; }
    .contact-type { font-size: 12px; color: #8E8E93; margin-top: 2px; }
    
    .contact-call {
      width: 38px;
      height: 38px;
      background: rgba(50,215,75,0.15);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
    }
    
    /* Footer */
    .footer {
      text-align: center;
      padding: 24px 0;
    }
    
    .footer-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: #1C1C1E;
      border-radius: 20px;
      font-size: 11px;
      color: #8E8E93;
    }
    
    /* =============================================
       MAP SCREEN - FULL SCREEN
       ============================================= */
    .map-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 10;
      padding: 14px 20px;
      background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
    }
    
    .map-container {
      position: relative;
      width: 100%;
      height: 100vh;
      background: #0a0a0a;
      overflow: hidden;
      touch-action: none;
    }
    
    .map-svg {
      width: 100%;
      height: 100%;
      cursor: grab;
      transition: transform 0.1s ease-out;
    }
    
    .map-svg:active {
      cursor: grabbing;
    }
    
    .map-svg.animating {
      transition: transform 0.4s ease-out;
    }
    
    /* Search overlay */
    .map-search {
      position: absolute;
      top: 60px;
      left: 16px;
      right: 70px;
      z-index: 15;
    }
    
    .search-input-wrap {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(28,28,30,0.95);
      backdrop-filter: blur(20px);
      border-radius: 14px;
      padding: 12px 16px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .search-input-wrap input {
      flex: 1;
      background: none;
      border: none;
      color: #fff;
      font-size: 16px;
      outline: none;
    }
    
    .search-input-wrap input::placeholder {
      color: #636366;
    }
    
    .search-clear {
      color: #636366;
      cursor: pointer;
      font-size: 14px;
      display: none;
    }
    
    .search-suggestions {
      display: none;
      background: rgba(28,28,30,0.98);
      backdrop-filter: blur(20px);
      border-radius: 14px;
      margin-top: 8px;
      border: 1px solid rgba(255,255,255,0.1);
      overflow: hidden;
    }
    
    .search-suggestions.show {
      display: block;
    }
    
    .suggestion-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .suggestion-item:last-child {
      border-bottom: none;
    }
    
    .suggestion-item:active {
      background: rgba(255,255,255,0.05);
    }
    
    .suggestion-name { font-weight: 600; font-size: 15px; }
    .suggestion-desc { font-size: 12px; color: #8E8E93; }
    
    .map-road {
      stroke: #2C2C2E;
      stroke-width: 3;
      fill: none;
    }
    
    .map-road-main {
      stroke: #3a3a3c;
      stroke-width: 5;
    }
    
    .map-area {
      fill: #1C1C1E;
      stroke: #2C2C2E;
      stroke-width: 1;
      cursor: pointer;
      transition: fill 0.2s;
    }
    
    .map-area:hover {
      fill: #252528;
    }
    
    /* Route path */
    .route-path-glow {
      stroke: rgba(100,210,255,0.2);
      stroke-width: 20;
      fill: none;
      stroke-linecap: round;
    }
    
    /* Alert markers */
    .alert-marker {
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .alert-marker:hover {
      transform: scale(1.15);
    }
    
    .marker-pulse {
      animation: marker-pulse 2s infinite;
    }
    
    @keyframes marker-pulse {
      0%, 100% { r: 20; opacity: 0.3; }
      50% { r: 28; opacity: 0; }
    }
    
    /* User location */
    .user-location {
      filter: drop-shadow(0 0 10px rgba(100,210,255,0.5));
    }
    
    .user-pulse {
      animation: user-pulse 2s infinite;
    }
    
    @keyframes user-pulse {
      0%, 100% { r: 20; opacity: 0.3; }
      50% { r: 30; opacity: 0; }
    }
    
    /* Map controls */
    .map-controls {
      position: absolute;
      right: 16px;
      top: 60px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 20;
    }
    
    .map-btn {
      width: 44px;
      height: 44px;
      background: rgba(28,28,30,0.95);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      backdrop-filter: blur(10px);
      transition: all 0.2s;
    }
    
    .map-btn:active {
      transform: scale(0.95);
      background: rgba(50,50,52,0.95);
    }
    
    .map-btn.active {
      background: rgba(100,210,255,0.2);
      border-color: rgba(100,210,255,0.4);
    }
    
    /* Zoom indicator */
    .zoom-indicator {
      position: absolute;
      top: 120px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(28,28,30,0.9);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 15;
    }
    
    .zoom-indicator.show {
      opacity: 1;
    }
    
    /* Legend */
    .map-legend {
      position: absolute;
      left: 16px;
      bottom: 280px;
      background: rgba(28,28,30,0.95);
      backdrop-filter: blur(20px);
      border-radius: 14px;
      padding: 14px 16px;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      z-index: 10;
    }
    
    .legend-title {
      font-weight: 600;
      margin-bottom: 10px;
      color: #8E8E93;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }
    
    .legend-item:last-child {
      margin-bottom: 0;
    }
    
    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    
    /* Marker popup */
    .marker-popup {
      position: absolute;
      bottom: 280px;
      left: 16px;
      right: 16px;
      background: rgba(28,28,30,0.98);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      z-index: 25;
      display: none;
      animation: slideUp 0.3s ease;
    }
    
    .marker-popup.show {
      display: block;
    }
    
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .popup-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 28px;
      height: 28px;
      background: #2C2C2E;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 14px;
      color: #8E8E93;
    }
    
    .popup-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 12px;
    }
    
    .popup-badge.danger {
      background: rgba(255,55,95,0.15);
      color: #FF375F;
    }
    
    .popup-badge.warning {
      background: rgba(255,159,10,0.15);
      color: #FF9F0A;
    }
    
    .popup-badge.safe {
      background: rgba(50,215,75,0.15);
      color: #32D74B;
    }
    
    .popup-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .popup-location {
      font-size: 14px;
      color: #8E8E93;
      margin-bottom: 4px;
    }
    
    .popup-time {
      font-size: 12px;
      color: #636366;
      margin-bottom: 12px;
    }
    
    .popup-desc {
      font-size: 15px;
      line-height: 1.5;
      margin-bottom: 16px;
    }
    
    .popup-actions {
      display: flex;
      gap: 10px;
    }
    
    .popup-btn {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      background: #64D2FF;
      color: #000;
    }
    
    .popup-btn.secondary {
      background: #2C2C2E;
      color: #fff;
    }
    
    /* Trip panel enhancements */
    .trip-panel {
      position: absolute;
      bottom: 90px;
      left: 16px;
      right: 16px;
      background: rgba(28,28,30,0.98);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      z-index: 20;
    }
    
    .trip-panel.hidden {
      display: none;
    }
    
    .trip-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .trip-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #32D74B;
      font-weight: 600;
    }
    
    .trip-status-dot {
      width: 8px;
      height: 8px;
      background: #32D74B;
      border-radius: 50%;
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
    
    .trip-share {
      font-size: 13px;
      color: #64D2FF;
      cursor: pointer;
    }
    
    .trip-destination {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 16px;
    }
    
    .trip-icon {
      width: 48px;
      height: 48px;
      background: rgba(50,215,75,0.15);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    
    .trip-info { flex: 1; }
    .trip-label { font-size: 12px; color: #8E8E93; }
    .trip-place { font-size: 18px; font-weight: 700; }
    
    .trip-progress-ring {
      position: relative;
      width: 50px;
      height: 50px;
    }
    
    .trip-progress-ring span {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 11px;
      font-weight: 700;
      color: #64D2FF;
    }
    
    .trip-stats {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .trip-stat {
      flex: 1;
      background: #1C1C1E;
      border-radius: 14px;
      padding: 14px 12px;
      text-align: center;
    }
    
    .trip-stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #64D2FF;
    }
    
    .trip-stat-label {
      font-size: 11px;
      color: #8E8E93;
      margin-top: 4px;
    }
    
    .trip-watchers-list {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
      padding: 12px;
      background: #1C1C1E;
      border-radius: 14px;
    }
    
    .watcher {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }
    
    .watcher-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
    }
    
    .watcher span {
      font-size: 11px;
      color: #8E8E93;
    }
    
    .trip-actions {
      display: flex;
      gap: 12px;
    }
    
    .trip-btn {
      flex: 1;
      padding: 14px;
      border-radius: 14px;
      font-size: 15px;
      font-weight: 600;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }
    
    .trip-btn:active {
      transform: scale(0.98);
    }
    
    .trip-btn.primary {
      background: #64D2FF;
      color: #000;
    }
    
    .trip-btn.secondary {
      background: #2C2C2E;
      color: #fff;
    }
    
    .trip-btn.danger {
      background: rgba(255,55,95,0.15);
      color: #FF375F;
    }
    
    /* Start Trip Panel */
    .start-trip-panel {
      position: absolute;
      bottom: 90px;
      left: 16px;
      right: 16px;
      background: rgba(28,28,30,0.98);
      backdrop-filter: blur(20px);
      border-radius: 24px;
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.1);
      z-index: 20;
    }
    
    .start-trip-panel.hidden {
      display: none;
    }
    
    /* Start Trip Toggle Button */
    .start-trip-toggle {
      position: absolute;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #64D2FF, #4AB8E8);
      padding: 14px 28px;
      border-radius: 30px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 15px;
      font-weight: 700;
      color: #000;
      cursor: pointer;
      box-shadow: 0 8px 30px rgba(100,210,255,0.4);
      z-index: 20;
      transition: all 0.2s;
    }
    
    .start-trip-toggle:active {
      transform: translateX(-50%) scale(0.95);
    }
    
    .start-trip-toggle.hidden {
      display: none;
    }
    
    .start-trip-title {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 16px;
      text-align: center;
    }
    
    .destination-input {
      display: flex;
      align-items: center;
      gap: 12px;
      background: #1C1C1E;
      border-radius: 14px;
      padding: 14px 16px;
      margin-bottom: 16px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    .destination-input input {
      flex: 1;
      background: none;
      border: none;
      color: #fff;
      font-size: 16px;
      outline: none;
    }
    
    .destination-input input::placeholder {
      color: #636366;
    }
    
    .recent-destinations {
      margin-bottom: 16px;
    }
    
    .recent-title {
      font-size: 12px;
      color: #8E8E93;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .recent-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: #1C1C1E;
      border-radius: 12px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .recent-item:active {
      background: #252528;
    }
    
    .recent-icon {
      font-size: 20px;
    }
    
    .recent-item > div {
      flex: 1;
    }
    
    .recent-name { font-weight: 600; font-size: 15px; }
    .recent-address { font-size: 12px; color: #8E8E93; }
    
    .recent-distance {
      font-size: 13px;
      color: #64D2FF;
      font-weight: 600;
    }
    
    .start-btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #64D2FF, #4AB8E8);
      border: none;
      border-radius: 14px;
      color: #000;
      font-size: 17px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.2s;
    }
    
    .start-btn:active {
      transform: scale(0.98);
    }
    
    /* Toast notification */
    .toast {
      position: absolute;
      top: 120px;
      left: 50%;
      transform: translateX(-50%) translateY(-20px);
      background: rgba(50,215,75,0.95);
      color: #000;
      padding: 12px 24px;
      border-radius: 30px;
      font-size: 14px;
      font-weight: 600;
      opacity: 0;
      transition: all 0.3s;
      z-index: 30;
      white-space: nowrap;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    /* =============================================
       CHECK-IN TIMER STYLES
       ============================================= */
    .checkin-intro {
      text-align: center;
      padding: 24px 16px;
      background: linear-gradient(135deg, rgba(255,159,10,0.1), rgba(255,159,10,0.02));
      border: 1px solid rgba(255,159,10,0.2);
      border-radius: 20px;
      margin-bottom: 24px;
    }
    
    .checkin-intro-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }
    
    .checkin-intro p {
      color: #8E8E93;
      font-size: 14px;
      line-height: 1.6;
    }
    
    /* Duration Grid */
    .duration-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .duration-option {
      background: #1C1C1E;
      border: 2px solid transparent;
      border-radius: 16px;
      padding: 16px 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .duration-option:active {
      transform: scale(0.95);
    }
    
    .duration-option.selected {
      background: rgba(255,159,10,0.15);
      border-color: #FF9F0A;
    }
    
    .duration-value {
      display: block;
      font-size: 28px;
      font-weight: 700;
      color: #fff;
    }
    
    .duration-option.selected .duration-value {
      color: #FF9F0A;
    }
    
    .duration-unit {
      display: block;
      font-size: 12px;
      color: #8E8E93;
      margin-top: 2px;
    }
    
    /* Custom Duration */
    .custom-duration {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #1C1C1E;
      border-radius: 14px;
      padding: 12px 16px;
      margin-bottom: 24px;
      font-size: 14px;
      color: #8E8E93;
    }
    
    .custom-duration input {
      width: 60px;
      background: #2C2C2E;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      color: #fff;
      font-size: 16px;
      text-align: center;
      outline: none;
    }
    
    .custom-set-btn {
      margin-left: auto;
      background: #2C2C2E;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      color: #64D2FF;
      font-weight: 600;
      cursor: pointer;
    }
    
    /* Reason Chips */
    .reason-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }
    
    .reason-chip {
      background: #1C1C1E;
      border: 1px solid transparent;
      border-radius: 20px;
      padding: 10px 16px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .reason-chip:active {
      transform: scale(0.95);
    }
    
    .reason-chip.selected {
      background: rgba(100,210,255,0.15);
      border-color: rgba(100,210,255,0.3);
      color: #64D2FF;
    }
    
    .reason-input-wrap {
      margin-bottom: 24px;
    }
    
    .reason-input-wrap input {
      width: 100%;
      background: #1C1C1E;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 14px 16px;
      color: #fff;
      font-size: 15px;
      outline: none;
    }
    
    .reason-input-wrap input:focus {
      border-color: rgba(100,210,255,0.4);
    }
    
    /* Notify Contacts */
    .notify-contacts {
      display: flex;
      gap: 20px;
      padding: 16px;
      background: #1C1C1E;
      border-radius: 16px;
      margin-bottom: 24px;
    }
    
    .notify-contact {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }
    
    .notify-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
    }
    
    .notify-contact span {
      font-size: 12px;
      color: #8E8E93;
    }
    
    /* Start Button */
    .checkin-start-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #FF9F0A, #e08900);
      border: none;
      border-radius: 16px;
      color: #000;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.2s;
    }
    
    .checkin-start-btn:active {
      transform: scale(0.98);
    }
    
    /* Active Timer Display */
    .timer-display {
      display: flex;
      justify-content: center;
      padding: 20px 0 30px;
    }
    
    .timer-ring {
      position: relative;
      width: 220px;
      height: 220px;
    }
    
    .timer-ring svg {
      transform: scaleX(-1);
    }
    
    .timer-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }
    
    .timer-time {
      font-size: 48px;
      font-weight: 700;
      color: #FF9F0A;
      font-variant-numeric: tabular-nums;
    }
    
    .timer-label {
      font-size: 14px;
      color: #8E8E93;
    }
    
    .timer-reason {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 20px;
      background: #1C1C1E;
      border-radius: 30px;
      margin: 0 auto 20px;
      width: fit-content;
      font-size: 15px;
    }
    
    .timer-warning {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px;
      background: rgba(255,159,10,0.1);
      border: 1px solid rgba(255,159,10,0.2);
      border-radius: 12px;
      margin-bottom: 24px;
      font-size: 13px;
      color: #FF9F0A;
    }
    
    /* Check In Confirm Button */
    .checkin-confirm-btn {
      width: 100%;
      padding: 20px;
      background: linear-gradient(135deg, #32D74B, #28a745);
      border: none;
      border-radius: 16px;
      color: #fff;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 16px;
      box-shadow: 0 8px 30px rgba(50,215,75,0.3);
      transition: all 0.2s;
    }
    
    .checkin-confirm-btn:active {
      transform: scale(0.98);
    }
    
    .checkin-icon {
      font-size: 24px;
    }
    
    .checkin-confirm-btn.pulse {
      animation: pulse-btn 1s infinite;
    }
    
    @keyframes pulse-btn {
      0%, 100% { box-shadow: 0 8px 30px rgba(50,215,75,0.3); }
      50% { box-shadow: 0 8px 50px rgba(50,215,75,0.5); }
    }
    
    /* Timer Actions */
    .timer-actions {
      display: flex;
      gap: 10px;
    }
    
    .timer-action-btn {
      flex: 1;
      padding: 14px 10px;
      background: #1C1C1E;
      border: none;
      border-radius: 14px;
      color: #fff;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      transition: all 0.2s;
    }
    
    .timer-action-btn:active {
      transform: scale(0.95);
    }
    
    .timer-action-btn span:first-child {
      font-size: 18px;
      font-weight: 700;
      color: #64D2FF;
    }
    
    .timer-action-btn.danger span:first-child {
      color: #FF375F;
    }
    
    /* Expired State */
    .expired-display {
      text-align: center;
      padding: 40px 20px;
    }
    
    .expired-icon {
      font-size: 80px;
      margin-bottom: 20px;
      animation: shake 0.5s infinite;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .expired-title {
      font-size: 28px;
      font-weight: 700;
      color: #FF375F;
      margin-bottom: 12px;
    }
    
    .expired-text {
      color: #8E8E93;
      font-size: 15px;
      line-height: 1.5;
      margin-bottom: 30px;
    }
    
    .expired-countdown {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px 24px;
      background: rgba(255,55,95,0.1);
      border: 1px solid rgba(255,55,95,0.3);
      border-radius: 16px;
      margin-bottom: 30px;
      font-size: 15px;
      color: #FF375F;
    }
    
    .expired-seconds {
      font-size: 32px;
      font-weight: 800;
      animation: pulse-count 0.5s infinite;
    }
    
    .checkin-safe-btn {
      width: 100%;
      padding: 20px;
      background: linear-gradient(135deg, #32D74B, #28a745);
      border: none;
      border-radius: 16px;
      color: #fff;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      animation: pulse-btn 0.8s infinite;
    }
    
    /* =============================================
       EVIDENCE RECORDER STYLES
       ============================================= */
    .screen-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .stealth-toggle {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      background: #1C1C1E;
      border-radius: 20px;
      font-size: 13px;
      color: #8E8E93;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .stealth-toggle.active {
      background: rgba(50,215,75,0.15);
      color: #32D74B;
    }
    
    .recorder-intro {
      text-align: center;
      padding: 24px 16px;
      background: linear-gradient(135deg, rgba(255,55,95,0.1), rgba(255,55,95,0.02));
      border: 1px solid rgba(255,55,95,0.2);
      border-radius: 20px;
      margin-bottom: 24px;
    }
    
    .recorder-intro-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }
    
    .recorder-intro p {
      color: #8E8E93;
      font-size: 14px;
      line-height: 1.6;
    }
    
    /* Record Type Toggle */
    .record-type-toggle {
      display: flex;
      background: #1C1C1E;
      border-radius: 14px;
      padding: 4px;
      margin-bottom: 24px;
    }
    
    .record-type {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      color: #8E8E93;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .record-type.active {
      background: #2C2C2E;
      color: #FF375F;
    }
    
    .record-type span:first-child {
      font-size: 20px;
    }
    
    /* Quality Options */
    .quality-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 24px;
    }
    
    .quality-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 16px;
      background: #1C1C1E;
      border: 2px solid transparent;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .quality-option.selected {
      background: rgba(255,55,95,0.1);
      border-color: rgba(255,55,95,0.3);
    }
    
    .quality-name {
      font-weight: 600;
      font-size: 15px;
    }
    
    .quality-option.selected .quality-name {
      color: #FF375F;
    }
    
    .quality-desc {
      font-size: 12px;
      color: #636366;
    }
    
    /* Auto Settings */
    .auto-settings {
      background: #1C1C1E;
      border-radius: 16px;
      overflow: hidden;
      margin-bottom: 20px;
    }
    
    .auto-setting {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    
    .auto-setting:last-child {
      border-bottom: none;
    }
    
    .auto-setting-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .auto-setting-icon {
      font-size: 24px;
    }
    
    .auto-setting-label {
      font-size: 15px;
      font-weight: 500;
    }
    
    .auto-setting-desc {
      font-size: 12px;
      color: #636366;
      margin-top: 2px;
    }
    
    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      width: 51px;
      height: 31px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #39393D;
      border-radius: 31px;
      transition: 0.3s;
    }
    
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 27px;
      width: 27px;
      left: 2px;
      bottom: 2px;
      background: white;
      border-radius: 50%;
      transition: 0.3s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .toggle-switch input:checked + .toggle-slider {
      background: #32D74B;
    }
    
    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(20px);
    }
    
    /* Storage Info */
    .storage-info {
      background: #1C1C1E;
      border-radius: 14px;
      padding: 14px 16px;
      margin-bottom: 20px;
    }
    
    .storage-bar {
      height: 6px;
      background: #2C2C2E;
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 8px;
    }
    
    .storage-used {
      height: 100%;
      background: linear-gradient(90deg, #64D2FF, #32D74B);
      border-radius: 3px;
    }
    
    .storage-text {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #8E8E93;
    }
    
    /* Record Start Button */
    .record-start-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #FF375F, #c41e3a);
      border: none;
      border-radius: 16px;
      color: #fff;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      box-shadow: 0 8px 30px rgba(255,55,95,0.3);
      transition: all 0.2s;
    }
    
    .record-start-btn:active {
      transform: scale(0.98);
    }
    
    .record-btn-icon {
      font-size: 24px;
      animation: pulse-rec 1.5s infinite;
    }
    
    @keyframes pulse-rec {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    /* Recordings List */
    .recordings-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .recording-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      background: #1C1C1E;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.06);
    }
    
    .recording-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    
    .recording-icon.audio {
      background: rgba(255,55,95,0.15);
    }
    
    .recording-icon.video {
      background: rgba(100,210,255,0.15);
    }
    
    .recording-info {
      flex: 1;
    }
    
    .recording-name {
      font-weight: 600;
      font-size: 15px;
    }
    
    .recording-meta {
      font-size: 12px;
      color: #636366;
      margin-top: 2px;
    }
    
    .recording-status {
      font-size: 16px;
    }
    
    .recording-actions {
      display: flex;
      gap: 12px;
      font-size: 18px;
    }
    
    .recording-actions span {
      cursor: pointer;
      padding: 4px;
    }
    
    /* Active Recording Display */
    .recording-display {
      text-align: center;
      padding: 20px 0;
    }
    
    .recording-indicator {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: rgba(255,55,95,0.15);
      border-radius: 20px;
      margin-bottom: 20px;
    }
    
    .rec-dot {
      width: 12px;
      height: 12px;
      background: #FF375F;
      border-radius: 50%;
      animation: blink 1s infinite;
    }
    
    .recording-indicator span {
      color: #FF375F;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 1px;
    }
    
    .recording-timer {
      font-size: 64px;
      font-weight: 700;
      color: #fff;
      font-variant-numeric: tabular-nums;
      margin-bottom: 24px;
    }
    
    /* Waveform */
    .waveform-container {
      height: 100px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .waveform {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      height: 80px;
    }
    
    .wave-bar {
      width: 6px;
      background: linear-gradient(to top, #FF375F, #FF6B8A);
      border-radius: 3px;
      animation: wave 0.5s ease-in-out infinite alternate;
    }
    
    .wave-bar:nth-child(1) { animation-delay: 0s; }
    .wave-bar:nth-child(2) { animation-delay: 0.1s; }
    .wave-bar:nth-child(3) { animation-delay: 0.2s; }
    .wave-bar:nth-child(4) { animation-delay: 0.1s; }
    .wave-bar:nth-child(5) { animation-delay: 0.3s; }
    .wave-bar:nth-child(6) { animation-delay: 0.2s; }
    .wave-bar:nth-child(7) { animation-delay: 0.1s; }
    .wave-bar:nth-child(8) { animation-delay: 0.4s; }
    .wave-bar:nth-child(9) { animation-delay: 0.2s; }
    .wave-bar:nth-child(10) { animation-delay: 0.3s; }
    .wave-bar:nth-child(11) { animation-delay: 0.1s; }
    .wave-bar:nth-child(12) { animation-delay: 0.2s; }
    .wave-bar:nth-child(13) { animation-delay: 0.3s; }
    .wave-bar:nth-child(14) { animation-delay: 0.1s; }
    .wave-bar:nth-child(15) { animation-delay: 0.2s; }
    .wave-bar:nth-child(16) { animation-delay: 0.4s; }
    .wave-bar:nth-child(17) { animation-delay: 0.1s; }
    .wave-bar:nth-child(18) { animation-delay: 0.3s; }
    .wave-bar:nth-child(19) { animation-delay: 0.2s; }
    .wave-bar:nth-child(20) { animation-delay: 0.1s; }
    
    @keyframes wave {
      0% { transform: scaleY(0.5); }
      100% { transform: scaleY(1.2); }
    }
    
    .waveform.paused .wave-bar {
      animation: none;
      transform: scaleY(0.3);
      opacity: 0.5;
    }
    
    /* Video Preview */
    .video-preview {
      height: 200px;
      background: #1C1C1E;
      border-radius: 16px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .video-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      color: #636366;
    }
    
    .video-placeholder span:first-child {
      font-size: 48px;
    }
    
    /* Recording Meta Info */
    .recording-meta-info {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-bottom: 20px;
    }
    
    .meta-item {
      text-align: center;
    }
    
    .meta-label {
      display: block;
      font-size: 11px;
      color: #636366;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .meta-value {
      display: block;
      font-size: 15px;
      font-weight: 600;
      margin-top: 4px;
    }
    
    /* Upload Status */
    .upload-status {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      background: rgba(50,215,75,0.1);
      border-radius: 12px;
      margin-bottom: 24px;
      font-size: 13px;
      color: #32D74B;
    }
    
    .upload-icon {
      font-size: 20px;
    }
    
    .upload-progress {
      flex: 1;
      height: 4px;
      background: rgba(50,215,75,0.2);
      border-radius: 2px;
      overflow: hidden;
      margin-left: auto;
      max-width: 80px;
    }
    
    .upload-progress-bar {
      height: 100%;
      background: #32D74B;
      border-radius: 2px;
      width: 0%;
      transition: width 0.3s;
    }
    
    /* Recording Controls */
    .recording-controls {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .rec-control-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding: 16px 24px;
      border: none;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .rec-control-btn span:first-child {
      font-size: 24px;
    }
    
    .rec-control-btn.pause {
      background: #2C2C2E;
      color: #fff;
    }
    
    .rec-control-btn.pause.active {
      background: rgba(255,159,10,0.15);
      color: #FF9F0A;
    }
    
    .rec-control-btn.stop {
      background: rgba(255,55,95,0.15);
      color: #FF375F;
    }
    
    .rec-control-btn.send {
      background: rgba(100,210,255,0.15);
      color: #64D2FF;
    }
    
    .rec-control-btn:active {
      transform: scale(0.95);
    }
    
    .rec-emergency-note {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px;
      background: #1C1C1E;
      border-radius: 12px;
      font-size: 12px;
      color: #8E8E93;
    }
    
    /* Recording Complete */
    .complete-display {
      text-align: center;
      padding: 30px 0;
    }
    
    .complete-icon {
      font-size: 64px;
      margin-bottom: 16px;
    }
    
    .complete-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 24px;
    }
    
    .complete-preview {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: #1C1C1E;
      border-radius: 16px;
      margin-bottom: 20px;
    }
    
    .preview-icon {
      width: 56px;
      height: 56px;
      background: rgba(255,55,95,0.15);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
    }
    
    .preview-info {
      flex: 1;
      text-align: left;
    }
    
    .preview-duration {
      font-size: 24px;
      font-weight: 700;
    }
    
    .preview-size {
      font-size: 13px;
      color: #8E8E93;
    }
    
    .preview-play {
      width: 48px;
      height: 48px;
      background: #32D74B;
      border: none;
      border-radius: 50%;
      font-size: 20px;
      cursor: pointer;
    }
    
    .complete-status {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 24px;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 10px;
      background: #1C1C1E;
      border-radius: 10px;
      font-size: 14px;
      color: #8E8E93;
    }
    
    .status-item.success {
      background: rgba(50,215,75,0.1);
      color: #32D74B;
    }
    
    .complete-actions {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .complete-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 16px;
      border: none;
      border-radius: 14px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
    }
    
    .complete-btn.primary {
      background: #64D2FF;
      color: #000;
    }
    
    .complete-btn.secondary {
      background: #2C2C2E;
      color: #fff;
    }
    
    .complete-done-btn {
      width: 100%;
      padding: 16px;
      background: transparent;
      border: 1px solid #2C2C2E;
      border-radius: 14px;
      color: #8E8E93;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
    }
    
    /* Stealth Mode */
    .stealth-mode .recording-display {
      opacity: 0.1;
    }
    
    .stealth-mode .recording-controls {
      opacity: 0.1;
    }
    
    .stealth-overlay {
      position: fixed;
      inset: 0;
      background: #000;
      z-index: 200;
      display: none;
      align-items: center;
      justify-content: center;
    }
    
    .stealth-overlay.show {
      display: flex;
    }
    
    .stealth-hint {
      color: #1a1a1a;
      font-size: 12px;
      text-align: center;
    }
    
    /* =============================================
       REPORT INCIDENT STYLES
       ============================================= */
    
    /* Emergency Hotlines Banner */
    .emergency-hotlines {
      background: linear-gradient(135deg, rgba(255,55,95,0.15), rgba(255,55,95,0.05));
      border: 1px solid rgba(255,55,95,0.3);
      border-radius: 16px;
      padding: 14px 16px;
      margin-bottom: 20px;
    }
    
    .hotline-header {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      color: #FF375F;
      margin-bottom: 10px;
    }
    
    .hotline-numbers {
      display: flex;
      gap: 10px;
    }
    
    .hotline-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 10px;
      background: rgba(255,55,95,0.2);
      border-radius: 10px;
      color: #fff;
      text-decoration: none;
      font-size: 14px;
      font-weight: 700;
      transition: all 0.2s;
    }
    
    .hotline-btn:active {
      transform: scale(0.95);
      background: rgba(255,55,95,0.4);
    }
    
    .hotline-btn.nscdc {
      font-size: 12px;
    }
    
    .incident-types {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 24px;
    }
    
    .incident-type {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 14px 8px;
      background: #1C1C1E;
      border: 2px solid transparent;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .incident-type:active {
      transform: scale(0.97);
    }
    
    .incident-type.selected {
      background: rgba(255,55,95,0.1);
      border-color: #FF375F;
    }
    
    /* Urgent incident types - special styling */
    .incident-type.urgent {
      background: linear-gradient(135deg, rgba(255,55,95,0.08), rgba(255,55,95,0.02));
      border: 1px solid rgba(255,55,95,0.2);
    }
    
    .incident-type.urgent .incident-label {
      color: #FF6B8A;
    }
    
    .incident-type.urgent.selected {
      background: rgba(255,55,95,0.15);
      border-color: #FF375F;
      box-shadow: 0 0 20px rgba(255,55,95,0.2);
    }
    
    .incident-icon {
      font-size: 26px;
    }
    
    .incident-label {
      font-size: 11px;
      font-weight: 600;
      text-align: center;
      color: #8E8E93;
      line-height: 1.2;
    }
    
    .incident-type.selected .incident-label {
      color: #FF375F;
    }
    
    /* Severity Options */
    .severity-options {
      display: flex;
      gap: 10px;
      margin-bottom: 24px;
    }
    
    .severity-option {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 14px 10px;
      background: #1C1C1E;
      border: 2px solid transparent;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 13px;
      font-weight: 600;
    }
    
    .severity-option:active {
      transform: scale(0.97);
    }
    
    .severity-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-bottom: 4px;
    }
    
    .severity-option.low .severity-dot {
      background: #32D74B;
    }
    
    .severity-option.medium .severity-dot {
      background: #FF9F0A;
    }
    
    .severity-option.high .severity-dot {
      background: #FF375F;
    }
    
    .severity-desc {
      font-size: 10px;
      font-weight: 400;
      color: #636366;
    }
    
    .severity-option.selected {
      border-color: rgba(255,255,255,0.2);
    }
    
    .severity-option.low.selected {
      background: rgba(50,215,75,0.1);
      border-color: rgba(50,215,75,0.3);
    }
    
    .severity-option.medium.selected {
      background: rgba(255,159,10,0.1);
      border-color: rgba(255,159,10,0.3);
    }
    
    .severity-option.high.selected {
      background: rgba(255,55,95,0.1);
      border-color: rgba(255,55,95,0.3);
    }
    
    /* Location Input */
    .location-input-group {
      margin-bottom: 24px;
    }
    
    .location-current {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      background: #1C1C1E;
      border: 2px solid transparent;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .location-current.selected {
      background: rgba(100,210,255,0.1);
      border-color: rgba(100,210,255,0.3);
    }
    
    .location-icon {
      font-size: 24px;
    }
    
    .location-info {
      flex: 1;
    }
    
    .location-label {
      font-size: 15px;
      font-weight: 600;
    }
    
    .location-address {
      font-size: 12px;
      color: #636366;
      margin-top: 2px;
    }
    
    .location-current.selected .location-address {
      color: #64D2FF;
    }
    
    .location-check {
      color: #64D2FF;
      font-size: 20px;
      font-weight: 700;
    }
    
    .location-divider {
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 12px 0;
      font-size: 12px;
      color: #636366;
    }
    
    .location-divider::before,
    .location-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: #2C2C2E;
      margin: 0 12px;
    }
    
    .location-manual-input {
      width: 100%;
      padding: 14px 16px;
      background: #1C1C1E;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 14px;
      color: #fff;
      font-size: 15px;
      outline: none;
    }
    
    .location-manual-input:focus {
      border-color: rgba(100,210,255,0.4);
    }
    
    /* Description */
    .report-description {
      width: 100%;
      padding: 14px 16px;
      background: #1C1C1E;
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 14px;
      color: #fff;
      font-size: 15px;
      font-family: inherit;
      resize: none;
      outline: none;
      margin-bottom: 24px;
    }
    
    .report-description:focus {
      border-color: rgba(100,210,255,0.4);
    }
    
    .report-description::placeholder {
      color: #636366;
    }
    
    /* Evidence Attach */
    .evidence-attach {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .evidence-option {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      padding: 14px;
      background: #1C1C1E;
      border: 1px dashed rgba(255,255,255,0.15);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 12px;
      color: #8E8E93;
    }
    
    .evidence-option:active {
      transform: scale(0.97);
    }
    
    .evidence-option span:first-child {
      font-size: 24px;
    }
    
    .attached-files {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 16px;
    }
    
    .attached-file {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: rgba(50,215,75,0.1);
      border: 1px solid rgba(50,215,75,0.2);
      border-radius: 10px;
      font-size: 13px;
    }
    
    .attached-file-remove {
      color: #FF375F;
      cursor: pointer;
      font-size: 16px;
    }
    
    /* Anonymous Toggle */
    .anonymous-toggle {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      background: #1C1C1E;
      border-radius: 14px;
      margin-bottom: 24px;
    }
    
    .anonymous-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .anonymous-icon {
      font-size: 24px;
    }
    
    .anonymous-label {
      font-size: 15px;
      font-weight: 600;
    }
    
    .anonymous-desc {
      font-size: 12px;
      color: #636366;
      margin-top: 2px;
    }
    
    /* Submit Button */
    .report-submit-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #FF375F, #c41e3a);
      border: none;
      border-radius: 16px;
      color: #fff;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 8px 30px rgba(255,55,95,0.3);
      transition: all 0.2s;
    }
    
    .report-submit-btn:active {
      transform: scale(0.98);
    }
    
    .report-submit-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .report-disclaimer {
      text-align: center;
      font-size: 11px;
      color: #636366;
      margin-top: 16px;
      line-height: 1.4;
    }
    
    /* Submitted State */
    .submitted-display {
      text-align: center;
      padding: 20px 0;
    }
    
    .submitted-icon {
      font-size: 64px;
      margin-bottom: 16px;
    }
    
    .submitted-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 12px;
    }
    
    .submitted-text {
      font-size: 14px;
      color: #8E8E93;
      line-height: 1.5;
      margin-bottom: 24px;
    }
    
    .submitted-card {
      background: #1C1C1E;
      border-radius: 16px;
      padding: 16px;
      text-align: left;
      margin-bottom: 20px;
    }
    
    .submitted-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    
    .submitted-type-icon {
      font-size: 32px;
    }
    
    .submitted-type {
      font-weight: 700;
      font-size: 16px;
    }
    
    .submitted-location {
      font-size: 13px;
      color: #8E8E93;
    }
    
    .submitted-severity {
      margin-left: auto;
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }
    
    .submitted-severity.low {
      background: rgba(50,215,75,0.15);
      color: #32D74B;
    }
    
    .submitted-severity.medium {
      background: rgba(255,159,10,0.15);
      color: #FF9F0A;
    }
    
    .submitted-severity.high {
      background: rgba(255,55,95,0.15);
      color: #FF375F;
    }
    
    .submitted-desc {
      font-size: 14px;
      color: #ccc;
      line-height: 1.5;
      margin-bottom: 12px;
    }
    
    .submitted-meta {
      display: flex;
      gap: 16px;
      font-size: 12px;
      color: #636366;
    }
    
    .submitted-stats {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 24px;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-value {
      display: block;
      font-size: 24px;
      font-weight: 700;
      color: #64D2FF;
    }
    
    .stat-label {
      display: block;
      font-size: 11px;
      color: #636366;
      margin-top: 4px;
    }
    
    .submitted-actions {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }
    
    .submitted-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px;
      border: none;
      border-radius: 14px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    
    .submitted-btn.primary {
      background: #25D366;
      color: #fff;
    }
    
    .submitted-btn.secondary {
      background: #2C2C2E;
      color: #fff;
    }
    
    .submitted-done-btn {
      width: 100%;
      padding: 14px;
      background: transparent;
      border: 1px solid #2C2C2E;
      border-radius: 14px;
      color: #8E8E93;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
    }
    
    /* =============================================
       HUB SCREEN (Community + History)
       ============================================= */
    .hub-tabs {
      display: flex;
      background: #1C1C1E;
      border-radius: 12px;
      padding: 4px;
      margin-bottom: 20px;
    }
    
    .hub-tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      color: #8E8E93;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .hub-tab.active {
      background: #2C2C2E;
      color: #fff;
    }
    
    .hub-content {
      display: none;
    }
    
    .hub-content.active {
      display: block;
    }
    
    /* Region filter */
    .region-filter {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 12px;
      margin-bottom: 16px;
      -webkit-overflow-scrolling: touch;
    }
    
    .region-filter::-webkit-scrollbar {
      display: none;
    }
    
    .region-pill {
      flex-shrink: 0;
      padding: 8px 16px;
      background: #1C1C1E;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      color: #8E8E93;
      border: 1px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .region-pill.active {
      background: rgba(255,55,95,0.15);
      color: #FF375F;
      border-color: rgba(255,55,95,0.3);
    }
    
    /* Alert cards */
    .alert-card {
      background: #1C1C1E;
      border-radius: 16px;
      padding: 14px;
      margin-bottom: 12px;
      border: 1px solid rgba(255,255,255,0.06);
    }
    
    .alert-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .alert-badge {
      padding: 4px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 600;
    }
    
    .alert-badge.danger {
      background: rgba(255,55,95,0.15);
      color: #FF375F;
    }
    
    .alert-badge.warning {
      background: rgba(255,159,10,0.15);
      color: #FF9F0A;
    }
    
    .alert-region {
      font-size: 12px;
      color: #8E8E93;
    }
    
    .alert-time {
      font-size: 11px;
      color: #636366;
      margin-left: auto;
    }
    
    .alert-content {
      font-size: 14px;
      line-height: 1.5;
      margin-bottom: 10px;
    }
    
    .alert-location {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: #8E8E93;
    }
    
    /* History items */
    .history-stats {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .history-stat {
      flex: 1;
      background: #1C1C1E;
      border-radius: 16px;
      padding: 16px;
      text-align: center;
    }
    
    .history-stat-value {
      font-size: 28px;
      font-weight: 700;
    }
    
    .history-stat-value.green { color: #32D74B; }
    .history-stat-value.orange { color: #FF9F0A; }
    .history-stat-value.blue { color: #64D2FF; }
    
    .history-stat-label {
      font-size: 11px;
      color: #8E8E93;
      margin-top: 4px;
    }
    
    .history-item {
      display: flex;
      align-items: center;
      gap: 14px;
      background: #1C1C1E;
      border-radius: 16px;
      padding: 14px;
      margin-bottom: 10px;
      border: 1px solid rgba(255,255,255,0.06);
    }
    
    .history-icon {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }
    
    .history-icon.sos { background: rgba(255,55,95,0.15); }
    .history-icon.trip { background: rgba(100,210,255,0.15); }
    .history-icon.timer { background: rgba(255,159,10,0.15); }
    .history-icon.report { background: rgba(50,215,75,0.15); }
    
    .history-info { flex: 1; }
    .history-title { font-weight: 600; font-size: 15px; }
    .history-meta { font-size: 12px; color: #8E8E93; margin-top: 2px; }
    
    .history-outcome {
      padding: 5px 10px;
      border-radius: 8px;
      font-size: 11px;
      font-weight: 600;
    }
    
    .history-outcome.resolved {
      background: rgba(50,215,75,0.15);
      color: #32D74B;
    }
    
    .history-outcome.cancelled {
      background: rgba(142,142,147,0.15);
      color: #8E8E93;
    }
    
    /* =============================================
       SETTINGS SCREEN
       ============================================= */
    .settings-group {
      margin-bottom: 24px;
    }
    
    .settings-group-title {
      font-size: 12px;
      color: #8E8E93;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
      padding-left: 4px;
    }
    
    .settings-item {
      display: flex;
      align-items: center;
      gap: 14px;
      background: #1C1C1E;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      cursor: pointer;
    }
    
    .settings-item:first-of-type {
      border-radius: 14px 14px 0 0;
    }
    
    .settings-item:last-of-type {
      border-radius: 0 0 14px 14px;
      border-bottom: none;
    }
    
    .settings-item:only-of-type {
      border-radius: 14px;
    }
    
    .settings-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    .settings-info { flex: 1; }
    .settings-label { font-size: 16px; }
    .settings-desc { font-size: 12px; color: #8E8E93; margin-top: 2px; }
    
    .settings-arrow {
      color: #636366;
      font-size: 18px;
    }
    
    /* Page title */
    .page-title {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 20px;
    }
    
    .back-btn {
      display: flex;
      align-items: center;
      gap: 4px;
      color: #64D2FF;
      font-size: 17px;
      cursor: pointer;
      padding: 8px 0;
    }
    
    .back-btn span:first-child {
      font-size: 24px;
      font-weight: 300;
    }
    
    /* =============================================
       BOTTOM NAVIGATION
       ============================================= */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      max-width: 430px;
      margin: 0 auto;
      background: rgba(28, 28, 30, 0.95);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-around;
      padding: 10px 0 28px;
      z-index: 50;
    }
    
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 8px 16px;
      color: #636366;
      text-decoration: none;
      font-size: 10px;
      font-weight: 500;
      transition: all 0.2s;
      cursor: pointer;
    }
    
    .nav-item.active {
      color: #FF375F;
    }
    
    .nav-icon {
      font-size: 24px;
      line-height: 1;
    }
    
    .nav-label {
      letter-spacing: 0.3px;
    }
    
    /* =============================================
       MODAL
       ============================================= */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.95);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 100;
      padding: 20px;
    }
    
    .modal.show { display: flex; }
    
    .modal-box {
      background: #1C1C1E;
      border-radius: 24px;
      padding: 32px 24px;
      max-width: 320px;
      width: 100%;
      text-align: center;
      border: 1px solid rgba(255,55,95,0.2);
    }
    
    .modal-icon { font-size: 60px; margin-bottom: 16px; }
    .modal-title { font-size: 22px; font-weight: 700; margin-bottom: 12px; }
    .modal-text { color: #8E8E93; font-size: 14px; margin-bottom: 20px; line-height: 1.5; }
    
    .countdown {
      font-size: 80px;
      font-weight: 800;
      color: #FF375F;
      text-shadow: 0 0 40px rgba(255,55,95,0.5);
      margin-bottom: 24px;
      animation: pulse-count 0.5s infinite;
    }
    
    @keyframes pulse-count {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.08); }
    }
    
    .modal-btns { display: flex; gap: 12px; }
    
    .modal-btn {
      flex: 1;
      padding: 16px;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 700;
      border: none;
      cursor: pointer;
    }
    
    .modal-btn.cancel { background: #2C2C2E; color: #fff; }
    .modal-btn.send { background: #FF375F; color: #fff; }
    .modal-btn.done { background: #32D74B; color: #fff; width: 100%; margin-top: 20px; }
    .modal-btn.end-emergency { 
      background: transparent; 
      border: 2px solid #64D2FF; 
      color: #64D2FF; 
      width: 100%; 
      margin-top: 10px; 
    }
    .modal-btn.end-emergency:active { background: rgba(100,210,255,0.1); }
    
    /* SOS triggered state */
    .sos-button.triggered {
      background: linear-gradient(145deg, #FF375F, #c41e3a);
      box-shadow: 0 0 60px rgba(255,55,95,0.6);
      animation: pulse-emergency 1s infinite;
    }
    @keyframes pulse-emergency {
      0%, 100% { box-shadow: 0 0 40px rgba(255,55,95,0.4); }
      50% { box-shadow: 0 0 80px rgba(255,55,95,0.7); }
    }
    .sos-button.triggered .sos-count { font-size: 48px; }
    
    .sent {
      background: rgba(50,215,75,0.1);
      border: 1px solid rgba(50,215,75,0.3);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 10px;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .sent-icon { font-size: 22px; }
    .sent-name { font-weight: 600; }
    .sent-status { font-size: 12px; color: #32D74B; }
  </style>
</head>
<body>
  <div class="app">
    <div class="glow" id="glow"></div>
    
    <!-- =============================================
         HOME SCREEN
         ============================================= -->
    <div class="screen active" id="homeScreen">
      <div class="status-bar">
        <span id="time">9:41</span>
        <span>üì∂ üìç üîã</span>
      </div>
      
      <div class="island" id="island">
        <div class="island-content">
          <div class="island-icon">üö®</div>
          <div>
            <div class="island-title">Emergency Active</div>
            <div class="island-sub">Help is on the way ‚Ä¢ 3 contacts notified</div>
          </div>
        </div>
      </div>
      
      <div class="header">
        <div class="logo">üõ°Ô∏è</div>
        <div>
          <h1>SafeAlert</h1>
          <p>üá≥üá¨ Nationwide Protection</p>
        </div>
      </div>
      
      <div class="location">
        <div class="location-icon">üìç</div>
        <div class="location-text">
          <div class="location-city">Ikeja</div>
          <div class="location-state">Lagos State, Nigeria</div>
        </div>
        <span class="location-change">Change</span>
      </div>
      
      <div class="safety" id="safety" onclick="onSafetyCardTap()" style="cursor:pointer;">
        <div class="safety-icon" id="safetyIcon">‚úì</div>
        <div>
          <div class="safety-title" id="safetyTitle">All Clear</div>
          <div class="safety-sub" id="safetySub">No threats detected in your area</div>
          <span class="safety-badge" id="safetyBadge">üü¢ Safe Zone</span>
        </div>
      </div>
      
      <div class="sos-wrap">
        <div class="sos-outer">
          <div class="sos-ring"></div>
          <button id="sosBtn" class="sos-button">
            <span class="sos-count" id="sosCount">SOS</span>
            <span class="sos-label" id="sosLabel">Hold for 3 seconds</span>
          </button>
        </div>
        
        <!-- End Emergency Button (hidden by default) -->
        <button class="end-emergency-btn" id="endEmergencyBtn2" onclick="endEmergency()" style="display:none;">
          <span>‚úì</span>
          <span>I'm Safe ‚Äî End Emergency</span>
        </button>
      </div>
      
      <div class="quick-actions">
        <div class="quick-action" onclick="switchScreen('checkinScreen')">
          <div class="quick-action-icon" style="background: rgba(255,159,10,0.15)">‚è±Ô∏è</div>
          <div class="quick-action-label">Check-In</div>
        </div>
        <div class="quick-action" onclick="switchScreen('recordScreen')">
          <div class="quick-action-icon" style="background: rgba(255,55,95,0.15)">üéôÔ∏è</div>
          <div class="quick-action-label">Record</div>
        </div>
        <div class="quick-action" onclick="switchScreen('reportScreen')">
          <div class="quick-action-icon" style="background: rgba(50,215,75,0.15)">üì¢</div>
          <div class="quick-action-label">Report</div>
        </div>
        <div class="quick-action" onclick="switchScreen('mapScreen')">
          <div class="quick-action-icon" style="background: rgba(100,210,255,0.15)">üìç</div>
          <div class="quick-action-label">Share Trip</div>
        </div>
      </div>
      
      <div class="section-header">
        <span class="section-title">Emergency Contacts</span>
        <span class="section-action">Edit</span>
      </div>
      
      <div class="contact">
        <div class="contact-avatar" style="background: linear-gradient(145deg, #3498db, #2980b9)">
          MA<div class="contact-status"></div>
        </div>
        <div class="contact-info">
          <div class="contact-name">Mama</div>
          <div class="contact-type">Family ‚Ä¢ +234 802 XXX XXXX</div>
        </div>
        <div class="contact-call">üìû</div>
      </div>
      
      <div class="contact">
        <div class="contact-avatar" style="background: linear-gradient(145deg, #FF9F0A, #e08900)">
          AD<div class="contact-status"></div>
        </div>
        <div class="contact-info">
          <div class="contact-name">Alhaji Danfodio</div>
          <div class="contact-type">Neighbor ‚Ä¢ +234 803 XXX XXXX</div>
        </div>
        <div class="contact-call">üìû</div>
      </div>
      
      <div class="contact">
        <div class="contact-avatar" style="background: linear-gradient(145deg, #32D74B, #28a745)">
          üõ°Ô∏è<div class="contact-status"></div>
        </div>
        <div class="contact-info">
          <div class="contact-name">Area Security</div>
          <div class="contact-type">Vigilante ‚Ä¢ +234 901 XXX XXXX</div>
        </div>
        <div class="contact-call">üìû</div>
      </div>
      
      <div class="footer">
        <div class="footer-badge">
          üá≥üá¨ NDPR Compliant ‚Ä¢ Serving all 36 States + FCT
        </div>
      </div>
    </div>
    
    <!-- =============================================
         MAP SCREEN (Full Screen)
         ============================================= -->
    <div class="screen fullscreen" id="mapScreen">
      <div class="map-container" id="mapContainer">
        <svg class="map-svg" id="mapSvg" viewBox="0 0 400 700">
          <defs>
            <!-- Route animation gradient -->
            <linearGradient id="routeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#64D2FF;stop-opacity:1" />
              <stop offset="50%" style="stop-color:#32D74B;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#64D2FF;stop-opacity:1" />
            </linearGradient>
            <!-- Glow filter -->
            <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
              <feGaussianBlur stdDeviation="3" result="blur"/>
              <feMerge>
                <feMergeNode in="blur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>
          
          <g id="mapContent">
            <rect width="800" height="1400" fill="#0a0a0a" x="-200" y="-350"/>
            
            <!-- Water/Lagos Lagoon -->
            <ellipse cx="350" cy="550" rx="150" ry="80" fill="#0d1f2d" opacity="0.5"/>
            <ellipse cx="50" cy="100" rx="100" ry="60" fill="#0d1f2d" opacity="0.3"/>
            
            <!-- Districts/Areas with names -->
            <!-- Ikeja -->
            <path class="map-area" d="M30,80 L150,50 L200,100 L160,180 L50,150 Z" id="area-ikeja" data-name="Ikeja"/>
            <!-- Yaba -->
            <path class="map-area" d="M200,100 L320,60 L370,140 L300,200 L200,180 Z" id="area-yaba" data-name="Yaba"/>
            <!-- Surulere -->
            <path class="map-area" d="M50,150 L160,180 L180,280 L80,320 L30,240 Z" id="area-surulere" data-name="Surulere"/>
            <!-- Maryland -->
            <path class="map-area" d="M300,200 L380,180 L400,300 L340,360 L260,320 Z" id="area-maryland" data-name="Maryland"/>
            <!-- Mushin -->
            <path class="map-area" d="M180,280 L260,320 L300,420 L200,460 L120,400 Z" id="area-mushin" data-name="Mushin"/>
            <!-- Oshodi -->
            <path class="map-area" d="M80,320 L180,280 L200,460 L100,500 L40,420 Z" id="area-oshodi" data-name="Oshodi"/>
            <!-- Victoria Island -->
            <path class="map-area" d="M260,320 L340,360 L360,480 L280,520 L200,460 Z" id="area-vi" data-name="Victoria Island"/>
            <!-- Lekki -->
            <path class="map-area" d="M280,520 L360,480 L420,560 L380,620 L300,600 Z" id="area-lekki" data-name="Lekki"/>
            <!-- Ikoyi -->
            <path class="map-area" d="M200,460 L280,520 L300,600 L220,580 L180,520 Z" id="area-ikoyi" data-name="Ikoyi"/>
            
            <!-- Area labels -->
            <text x="100" y="120" fill="#3a3a3c" font-size="12" font-weight="600">Ikeja</text>
            <text x="270" y="130" fill="#3a3a3c" font-size="12" font-weight="600">Yaba</text>
            <text x="90" y="240" fill="#3a3a3c" font-size="11" font-weight="600">Surulere</text>
            <text x="320" y="280" fill="#3a3a3c" font-size="11" font-weight="600">Maryland</text>
            <text x="200" y="380" fill="#3a3a3c" font-size="11" font-weight="600">Mushin</text>
            <text x="100" y="420" fill="#3a3a3c" font-size="11" font-weight="600">Oshodi</text>
            <text x="290" y="440" fill="#3a3a3c" font-size="11" font-weight="600">V.I.</text>
            <text x="340" y="560" fill="#3a3a3c" font-size="11" font-weight="600">Lekki</text>
            <text x="230" y="540" fill="#3a3a3c" font-size="11" font-weight="600">Ikoyi</text>
            
            <!-- Main roads -->
            <path class="map-road map-road-main" d="M-50,250 Q120,250 200,220 T450,250" id="road-main1"/>
            <path class="map-road map-road-main" d="M200,-50 Q200,150 200,300 T200,750" id="road-main2"/>
            <path class="map-road map-road-main" d="M-50,450 Q100,420 200,460 Q300,500 450,480" id="road-third-mainland"/>
            
            <!-- Secondary roads -->
            <path class="map-road" d="M60,120 Q130,140 200,140"/>
            <path class="map-road" d="M200,140 Q280,140 350,110"/>
            <path class="map-road" d="M80,380 Q150,350 200,380"/>
            <path class="map-road" d="M200,380 Q270,400 350,380"/>
            <path class="map-road" d="M100,200 L160,280"/>
            <path class="map-road" d="M300,280 L340,380"/>
            <path class="map-road" d="M220,480 L280,560"/>
            <path class="map-road" d="M300,520 L360,560"/>
            
            <!-- Route path background glow -->
            <path class="route-path-glow" d="M200,300 Q220,360 240,420 Q270,480 300,520" id="routeGlow" style="display:none"/>
            
            <!-- Route path animated -->
            <path id="routePath" d="M200,300 Q220,360 240,420 Q270,480 300,520" 
                  fill="none" stroke="#64D2FF" stroke-width="5" stroke-linecap="round"
                  stroke-dasharray="1000" stroke-dashoffset="1000" style="display:none; filter: url(#glow);"/>
            
            <!-- Route traveled (completed portion) -->
            <path id="routeTraveled" d="M200,300 Q220,360 240,420 Q270,480 300,520" 
                  fill="none" stroke="#32D74B" stroke-width="5" stroke-linecap="round"
                  stroke-dasharray="0 1000" style="display:none; filter: url(#glow);"/>
            
            <!-- Alert markers with click targets -->
            <!-- Ikeja Alert - Armed Robbery -->
            <g class="alert-marker" id="marker1" transform="translate(130, 140)" onclick="showMarkerInfo(1)" style="cursor:pointer">
              <circle class="marker-pulse" cx="0" cy="0" r="20" fill="#FF375F" opacity="0.3"/>
              <circle cx="0" cy="0" r="14" fill="#FF375F" stroke="#000" stroke-width="2"/>
              <text x="0" y="5" text-anchor="middle" fill="white" font-size="12" font-weight="bold">!</text>
            </g>
            
            <!-- Maryland Alert - Suspicious Activity -->
            <g class="alert-marker" id="marker2" transform="translate(320, 300)" onclick="showMarkerInfo(2)" style="cursor:pointer">
              <circle class="marker-pulse" cx="0" cy="0" r="20" fill="#FF9F0A" opacity="0.3"/>
              <circle cx="0" cy="0" r="14" fill="#FF9F0A" stroke="#000" stroke-width="2"/>
              <text x="0" y="5" text-anchor="middle" fill="white" font-size="11" font-weight="bold">‚ö†</text>
            </g>
            
            <!-- Oshodi Alert - Traffic -->
            <g class="alert-marker" id="marker3" transform="translate(120, 440)" onclick="showMarkerInfo(3)" style="cursor:pointer">
              <circle class="marker-pulse" cx="0" cy="0" r="20" fill="#FF9F0A" opacity="0.3"/>
              <circle cx="0" cy="0" r="14" fill="#FF9F0A" stroke="#000" stroke-width="2"/>
              <text x="0" y="5" text-anchor="middle" fill="white" font-size="11" font-weight="bold">‚ö†</text>
            </g>
            
            <!-- Safe zone - Lekki checkpoint -->
            <g class="alert-marker" id="marker4" transform="translate(350, 540)" onclick="showMarkerInfo(4)" style="cursor:pointer">
              <circle cx="0" cy="0" r="14" fill="#32D74B" stroke="#000" stroke-width="2"/>
              <text x="0" y="5" text-anchor="middle" fill="white" font-size="12" font-weight="bold">‚úì</text>
            </g>
            
            <!-- Destination marker -->
            <g id="destMarker" transform="translate(300, 520)" style="display:none">
              <circle cx="0" cy="-20" r="8" fill="#32D74B"/>
              <path d="M0,0 L-10,-25 Q0,-35 10,-25 Z" fill="#32D74B" stroke="#000" stroke-width="1"/>
              <circle cx="0" cy="-20" r="4" fill="white"/>
            </g>
            
            <!-- User location -->
            <g class="user-location" id="userMarker" transform="translate(200, 300)">
              <circle class="user-pulse" cx="0" cy="0" r="20" fill="#64D2FF" opacity="0.3"/>
              <circle cx="0" cy="0" r="12" fill="#64D2FF" stroke="#fff" stroke-width="3"/>
              <circle cx="0" cy="0" r="5" fill="white"/>
              <!-- Direction indicator -->
              <path id="userDirection" d="M0,-18 L5,-10 L-5,-10 Z" fill="#64D2FF" style="display:none"/>
            </g>
          </g>
        </svg>
        
        <!-- Map Header -->
        <div class="map-header">
          <div class="status-bar" style="padding: 0;">
            <span id="time2">9:41</span>
            <span>üì∂ üìç üîã</span>
          </div>
        </div>
        
        <!-- Search overlay -->
        <div class="map-search" id="mapSearch">
          <div class="search-input-wrap">
            <span>üîç</span>
            <input type="text" placeholder="Search location..." id="mapSearchInput" onfocus="showSearchSuggestions()" oninput="filterSuggestions()">
            <span class="search-clear" onclick="clearSearch()">‚úï</span>
          </div>
          <div class="search-suggestions" id="searchSuggestions">
            <div class="suggestion-item" onclick="goToLocation('ikeja')">
              <span>üìç</span>
              <div><div class="suggestion-name">Ikeja</div><div class="suggestion-desc">Lagos State</div></div>
            </div>
            <div class="suggestion-item" onclick="goToLocation('vi')">
              <span>üìç</span>
              <div><div class="suggestion-name">Victoria Island</div><div class="suggestion-desc">Lagos State</div></div>
            </div>
            <div class="suggestion-item" onclick="goToLocation('lekki')">
              <span>üìç</span>
              <div><div class="suggestion-name">Lekki</div><div class="suggestion-desc">Lagos State</div></div>
            </div>
            <div class="suggestion-item" onclick="goToLocation('yaba')">
              <span>üìç</span>
              <div><div class="suggestion-name">Yaba</div><div class="suggestion-desc">Lagos State</div></div>
            </div>
            <div class="suggestion-item" onclick="goToLocation('ikoyi')">
              <span>üìç</span>
              <div><div class="suggestion-name">Ikoyi</div><div class="suggestion-desc">Lagos State</div></div>
            </div>
          </div>
        </div>
        
        <!-- Map controls -->
        <div class="map-controls">
          <div class="map-btn" onclick="centerOnUser()" id="centerBtn">üìç</div>
          <div class="map-btn" onclick="zoomIn()">+</div>
          <div class="map-btn" onclick="zoomOut()">‚àí</div>
          <div class="map-btn" onclick="toggleMapStyle()" id="styleBtn">üó∫Ô∏è</div>
        </div>
        
        <!-- Zoom indicator -->
        <div class="zoom-indicator" id="zoomIndicator">100%</div>
        
        <!-- Legend -->
        <div class="map-legend" id="mapLegend">
          <div class="legend-title">Map Legend</div>
          <div class="legend-item"><div class="legend-dot" style="background:#FF375F"></div><span>High Alert</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#FF9F0A"></div><span>Caution</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#32D74B"></div><span>Safe Zone</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#64D2FF"></div><span>Your Location</span></div>
        </div>
        
        <!-- Marker Info Popup -->
        <div class="marker-popup" id="markerPopup">
          <div class="popup-close" onclick="hideMarkerInfo()">‚úï</div>
          <div class="popup-badge" id="popupBadge">üö® High Alert</div>
          <div class="popup-title" id="popupTitle">Armed Robbery</div>
          <div class="popup-location" id="popupLocation">üìç Computer Village, Ikeja</div>
          <div class="popup-time" id="popupTime">18 minutes ago</div>
          <div class="popup-desc" id="popupDesc">Armed robbery reported. Avoid the area.</div>
          <div class="popup-actions">
            <button class="popup-btn" onclick="navigateToAlert()">üß≠ Navigate</button>
            <button class="popup-btn secondary" onclick="shareAlert()">üì§ Share</button>
          </div>
        </div>
        
        <!-- Start Trip Toggle Button -->
        <div class="start-trip-toggle" id="startTripToggle" onclick="toggleTripPanel()">
          <span>üìç</span>
          <span>Start Trip</span>
        </div>
        
        <!-- Start Trip Panel (hidden by default) -->
        <div class="start-trip-panel hidden" id="startTripPanel">
          <div class="start-trip-title">üó∫Ô∏è Trip Monitoring</div>
          
          <div class="destination-input">
            <span>üìç</span>
            <input type="text" placeholder="Where are you going?" id="destInput" list="destinations">
            <datalist id="destinations">
              <option value="Victoria Island">
              <option value="Lekki">
              <option value="Ikeja">
              <option value="Yaba">
              <option value="Ikoyi">
              <option value="Surulere">
              <option value="Maryland">
            </datalist>
          </div>
          
          <div class="recent-destinations">
            <div class="recent-title">Recent Destinations</div>
            <div class="recent-item" onclick="selectDestination('Victoria Island', 300, 520)">
              <span class="recent-icon">üíº</span>
              <div>
                <div class="recent-name">Work</div>
                <div class="recent-address">Victoria Island, Lagos</div>
              </div>
              <span class="recent-distance">4.2 km</span>
            </div>
            <div class="recent-item" onclick="selectDestination('Lekki', 350, 580)">
              <span class="recent-icon">üè†</span>
              <div>
                <div class="recent-name">Home</div>
                <div class="recent-address">Lekki, Lagos</div>
              </div>
              <span class="recent-distance">8.5 km</span>
            </div>
            <div class="recent-item" onclick="selectDestination('Ikeja', 130, 120)">
              <span class="recent-icon">üõí</span>
              <div>
                <div class="recent-name">Computer Village</div>
                <div class="recent-address">Ikeja, Lagos</div>
              </div>
              <span class="recent-distance">2.1 km</span>
            </div>
          </div>
          
          <button class="start-btn" onclick="startTrip()">
            <span>‚ñ∂Ô∏è</span>
            <span>Start Trip Monitoring</span>
          </button>
        </div>
        
        <!-- Active Trip Panel -->
        <div class="trip-panel hidden" id="tripPanel">
          <div class="trip-header">
            <div class="trip-status">
              <div class="trip-status-dot"></div>
              <span>Live Tracking</span>
            </div>
            <div class="trip-share" onclick="shareTrip()">üì§ Share</div>
          </div>
          
          <div class="trip-destination">
            <div class="trip-icon">üèÅ</div>
            <div class="trip-info">
              <div class="trip-label">Heading to</div>
              <div class="trip-place" id="tripDest">Victoria Island</div>
            </div>
            <div class="trip-progress-ring">
              <svg width="50" height="50">
                <circle cx="25" cy="25" r="20" stroke="#2C2C2E" stroke-width="4" fill="none"/>
                <circle cx="25" cy="25" r="20" stroke="#64D2FF" stroke-width="4" fill="none"
                        stroke-dasharray="125.6" stroke-dashoffset="125.6" id="progressRing"
                        transform="rotate(-90 25 25)"/>
              </svg>
              <span id="progressPercent">0%</span>
            </div>
          </div>
          
          <div class="trip-stats">
            <div class="trip-stat">
              <div class="trip-stat-value" id="tripDistance">4.2</div>
              <div class="trip-stat-label">km left</div>
            </div>
            <div class="trip-stat">
              <div class="trip-stat-value" id="tripEta">12</div>
              <div class="trip-stat-label">min ETA</div>
            </div>
            <div class="trip-stat">
              <div class="trip-stat-value" id="tripWatchers">3</div>
              <div class="trip-stat-label">watching</div>
            </div>
          </div>
          
          <div class="trip-watchers-list">
            <div class="watcher">
              <div class="watcher-avatar" style="background: linear-gradient(145deg, #3498db, #2980b9)">MA</div>
              <span>Mama</span>
            </div>
            <div class="watcher">
              <div class="watcher-avatar" style="background: linear-gradient(145deg, #FF9F0A, #e08900)">AD</div>
              <span>Alhaji</span>
            </div>
            <div class="watcher">
              <div class="watcher-avatar" style="background: linear-gradient(145deg, #32D74B, #28a745)">üõ°Ô∏è</div>
              <span>Security</span>
            </div>
          </div>
          
          <div class="trip-actions">
            <button class="trip-btn secondary" onclick="sendCheckIn()">
              <span>‚úì</span> Check In
            </button>
            <button class="trip-btn danger" onclick="endTrip()">
              <span>‚óº</span> End Trip
            </button>
          </div>
        </div>
        
        <!-- Check-in toast -->
        <div class="toast" id="toast">‚úì Check-in sent to 3 watchers</div>
      </div>
    </div>
    
    <!-- =============================================
         HUB SCREEN (Community + History)
         ============================================= -->
    <div class="screen" id="hubScreen">
      <div class="status-bar">
        <span id="time3">9:41</span>
        <span>üì∂ üìç üîã</span>
      </div>
      
      <h1 class="page-title">Hub</h1>
      
      <!-- Tabs -->
      <div class="hub-tabs">
        <div class="hub-tab active" onclick="switchHubTab('community')">üö® Alerts</div>
        <div class="hub-tab" onclick="switchHubTab('history')">üìã History</div>
      </div>
      
      <!-- Community Content -->
      <div class="hub-content active" id="communityContent">
        <div class="region-filter">
          <div class="region-pill active">Lagos</div>
          <div class="region-pill">Abuja</div>
          <div class="region-pill">Kano</div>
          <div class="region-pill">Rivers</div>
          <div class="region-pill">Oyo</div>
        </div>
        
        <div class="alert-card">
          <div class="alert-header">
            <span class="alert-badge danger">üö® High Alert</span>
            <span class="alert-region">Ikeja</span>
            <span class="alert-time">18 min ago</span>
          </div>
          <div class="alert-content">
            Armed robbery reported near Computer Village. Avoid the area if possible.
          </div>
          <div class="alert-location">
            <span>üìç</span>
            <span>Otigba Street, Computer Village</span>
          </div>
        </div>
        
        <div class="alert-card">
          <div class="alert-header">
            <span class="alert-badge warning">‚ö†Ô∏è Caution</span>
            <span class="alert-region">Oshodi</span>
            <span class="alert-time">45 min ago</span>
          </div>
          <div class="alert-content">
            Suspicious activity reported under bridge. Police have been notified.
          </div>
          <div class="alert-location">
            <span>üìç</span>
            <span>Oshodi Under Bridge</span>
          </div>
        </div>
        
        <div class="alert-card">
          <div class="alert-header">
            <span class="alert-badge warning">‚ö†Ô∏è Caution</span>
            <span class="alert-region">VI</span>
            <span class="alert-time">1 hour ago</span>
          </div>
          <div class="alert-content">
            Heavy traffic due to VIP movement. Expect delays on Ozumba Mbadiwe.
          </div>
          <div class="alert-location">
            <span>üìç</span>
            <span>Ozumba Mbadiwe Avenue</span>
          </div>
        </div>
      </div>
      
      <!-- History Content -->
      <div class="hub-content" id="historyContent">
        <div class="history-stats">
          <div class="history-stat">
            <div class="history-stat-value green">47</div>
            <div class="history-stat-label">Days Safe</div>
          </div>
          <div class="history-stat">
            <div class="history-stat-value orange">3</div>
            <div class="history-stat-label">Alerts</div>
          </div>
          <div class="history-stat">
            <div class="history-stat-value blue">12</div>
            <div class="history-stat-label">Trips</div>
          </div>
        </div>
        
        <div class="section-header">
          <span class="section-title">Recent Activity</span>
        </div>
        
        <div class="history-item">
          <div class="history-icon trip">üìç</div>
          <div class="history-info">
            <div class="history-title">Trip to Victoria Island</div>
            <div class="history-meta">Today, 2:30 PM ‚Ä¢ 4.2 km</div>
          </div>
          <div class="history-outcome resolved">‚úì Safe</div>
        </div>
        
        <div class="history-item">
          <div class="history-icon timer">‚è±Ô∏è</div>
          <div class="history-info">
            <div class="history-title">Check-In Timer</div>
            <div class="history-meta">Today, 11:00 AM ‚Ä¢ 15 min</div>
          </div>
          <div class="history-outcome resolved">‚úì Checked In</div>
        </div>
        
        <div class="history-item">
          <div class="history-icon sos">üö®</div>
          <div class="history-info">
            <div class="history-title">Emergency Alert</div>
            <div class="history-meta">Nov 28 ‚Ä¢ Ikeja</div>
          </div>
          <div class="history-outcome cancelled">Cancelled</div>
        </div>
        
        <div class="history-item">
          <div class="history-icon report">üì¢</div>
          <div class="history-info">
            <div class="history-title">Incident Report</div>
            <div class="history-meta">Nov 25 ‚Ä¢ Suspicious Activity</div>
          </div>
          <div class="history-outcome resolved">‚úì Submitted</div>
        </div>
        
        <div class="history-item">
          <div class="history-icon trip">üìç</div>
          <div class="history-info">
            <div class="history-title">Trip to Lekki</div>
            <div class="history-meta">Nov 24 ‚Ä¢ 8.5 km</div>
          </div>
          <div class="history-outcome resolved">‚úì Safe</div>
        </div>
      </div>
    </div>
    
    <!-- =============================================
         CHECK-IN TIMER SCREEN
         ============================================= -->
    <div class="screen" id="checkinScreen">
      <div class="status-bar">
        <span id="time5">9:41</span>
        <span>üì∂ üìç üîã</span>
      </div>
      
      <!-- Header with back button -->
      <div class="screen-header">
        <div class="back-btn" onclick="switchScreen('homeScreen')">
          <span>‚Äπ</span>
          <span>Home</span>
        </div>
      </div>
      
      <h1 class="page-title">Check-In Timer</h1>
      
      <!-- Inactive State -->
      <div id="checkinSetup">
        <div class="checkin-intro">
          <div class="checkin-intro-icon">‚è±Ô∏è</div>
          <p>Set a timer. If you don't check in before it expires, your emergency contacts will be alerted automatically.</p>
        </div>
        
        <!-- Duration Selection -->
        <div class="section-header">
          <span class="section-title">Select Duration</span>
        </div>
        
        <div class="duration-grid">
          <div class="duration-option" onclick="selectDuration(15, this)">
            <span class="duration-value">15</span>
            <span class="duration-unit">min</span>
          </div>
          <div class="duration-option selected" onclick="selectDuration(30, this)">
            <span class="duration-value">30</span>
            <span class="duration-unit">min</span>
          </div>
          <div class="duration-option" onclick="selectDuration(60, this)">
            <span class="duration-value">1</span>
            <span class="duration-unit">hour</span>
          </div>
          <div class="duration-option" onclick="selectDuration(120, this)">
            <span class="duration-value">2</span>
            <span class="duration-unit">hours</span>
          </div>
        </div>
        
        <!-- Custom Duration -->
        <div class="custom-duration">
          <span>Custom:</span>
          <input type="number" id="customMinutes" placeholder="45" min="5" max="480">
          <span>minutes</span>
          <button class="custom-set-btn" onclick="setCustomDuration()">Set</button>
        </div>
        
        <!-- Reason/Context -->
        <div class="section-header">
          <span class="section-title">What are you doing? (Optional)</span>
        </div>
        
        <div class="reason-chips">
          <div class="reason-chip" onclick="selectReason('Walking home', this)">üö∂ Walking home</div>
          <div class="reason-chip" onclick="selectReason('Meeting someone', this)">ü§ù Meeting someone</div>
          <div class="reason-chip" onclick="selectReason('Night outing', this)">üåô Night outing</div>
          <div class="reason-chip" onclick="selectReason('Traveling', this)">üöó Traveling</div>
          <div class="reason-chip" onclick="selectReason('At ATM', this)">üèß At ATM</div>
          <div class="reason-chip" onclick="selectReason('Other', this)">üìù Other</div>
        </div>
        
        <div class="reason-input-wrap" id="reasonInputWrap" style="display:none;">
          <input type="text" id="customReason" placeholder="Describe your activity...">
        </div>
        
        <!-- Who will be notified -->
        <div class="section-header">
          <span class="section-title">Will notify if you don't check in</span>
        </div>
        
        <div class="notify-contacts">
          <div class="notify-contact">
            <div class="notify-avatar" style="background: linear-gradient(145deg, #3498db, #2980b9)">MA</div>
            <span>Mama</span>
          </div>
          <div class="notify-contact">
            <div class="notify-avatar" style="background: linear-gradient(145deg, #FF9F0A, #e08900)">AD</div>
            <span>Alhaji</span>
          </div>
          <div class="notify-contact">
            <div class="notify-avatar" style="background: linear-gradient(145deg, #32D74B, #28a745)">üõ°Ô∏è</div>
            <span>Security</span>
          </div>
        </div>
        
        <!-- Start Button -->
        <button class="checkin-start-btn" onclick="startCheckinTimer()">
          <span>‚ñ∂Ô∏è</span>
          <span>Start Timer</span>
        </button>
      </div>
      
      <!-- Active Timer State -->
      <div id="checkinActive" style="display:none;">
        <div class="timer-display">
          <div class="timer-ring">
            <svg width="220" height="220">
              <circle cx="110" cy="110" r="100" stroke="#2C2C2E" stroke-width="8" fill="none"/>
              <circle cx="110" cy="110" r="100" stroke="#FF9F0A" stroke-width="8" fill="none"
                      stroke-dasharray="628" stroke-dashoffset="0" id="timerRing"
                      stroke-linecap="round" transform="rotate(-90 110 110)"/>
            </svg>
            <div class="timer-center">
              <div class="timer-time" id="timerDisplay">30:00</div>
              <div class="timer-label">remaining</div>
            </div>
          </div>
        </div>
        
        <div class="timer-reason" id="timerReasonDisplay">
          <span>üö∂</span>
          <span id="activeReason">Walking home</span>
        </div>
        
        <div class="timer-warning">
          <span>‚ö†Ô∏è</span>
          <span>If you don't check in, 3 contacts will be alerted</span>
        </div>
        
        <!-- Check In Button (Big) -->
        <button class="checkin-confirm-btn" id="checkinConfirmBtn" onclick="confirmCheckin()">
          <span class="checkin-icon">‚úì</span>
          <span>I'm Safe - Check In</span>
        </button>
        
        <!-- Secondary Actions -->
        <div class="timer-actions">
          <button class="timer-action-btn" onclick="extendTimer()">
            <span>+5</span>
            <span>Add 5 min</span>
          </button>
          <button class="timer-action-btn" onclick="extendTimer(15)">
            <span>+15</span>
            <span>Add 15 min</span>
          </button>
          <button class="timer-action-btn danger" onclick="cancelCheckinTimer()">
            <span>‚úï</span>
            <span>Cancel</span>
          </button>
        </div>
      </div>
      
      <!-- Timer Expired State -->
      <div id="checkinExpired" style="display:none;">
        <div class="expired-display">
          <div class="expired-icon">üö®</div>
          <h2 class="expired-title">Timer Expired!</h2>
          <p class="expired-text">You didn't check in. Emergency alerts are being sent to your contacts.</p>
          
          <div class="expired-countdown">
            <span>Sending alerts in</span>
            <span class="expired-seconds" id="expiredSeconds">10</span>
            <span>seconds</span>
          </div>
          
          <button class="checkin-safe-btn" onclick="imSafeCancel()">
            <span>‚úì</span>
            <span>I'm Safe - Cancel Alert</span>
          </button>
        </div>
      </div>
    </div>
    
    <!-- =============================================
         EVIDENCE RECORDER SCREEN
         ============================================= -->
    <div class="screen" id="recordScreen">
      <div class="status-bar">
        <span id="time6">9:41</span>
        <span>üì∂ üìç üîã</span>
      </div>
      
      <div class="screen-header">
        <div class="back-btn" onclick="switchScreen('homeScreen')">
          <span>‚Äπ</span>
          <span>Home</span>
        </div>
        <div class="stealth-toggle" onclick="toggleStealthMode()">
          <span id="stealthIcon">üëÅÔ∏è</span>
          <span id="stealthLabel">Stealth</span>
        </div>
      </div>
      
      <h1 class="page-title">Evidence Recorder</h1>
      
      <!-- Recorder Inactive State -->
      <div id="recorderSetup">
        <div class="recorder-intro">
          <div class="recorder-intro-icon">üéôÔ∏è</div>
          <p>Record audio or video evidence. Files are automatically saved and can be sent to your emergency contacts.</p>
        </div>
        
        <!-- Recording Type Toggle -->
        <div class="record-type-toggle">
          <div class="record-type active" id="audioType" onclick="selectRecordType('audio')">
            <span>üé§</span>
            <span>Audio</span>
          </div>
          <div class="record-type" id="videoType" onclick="selectRecordType('video')">
            <span>üìπ</span>
            <span>Video</span>
          </div>
        </div>
        
        <!-- Quality Selection -->
        <div class="section-header">
          <span class="section-title">Quality</span>
        </div>
        
        <div class="quality-options">
          <div class="quality-option" onclick="selectQuality('low', this)">
            <span class="quality-name">Low</span>
            <span class="quality-desc">~1MB/min ‚Ä¢ Longer recording</span>
          </div>
          <div class="quality-option selected" onclick="selectQuality('medium', this)">
            <span class="quality-name">Medium</span>
            <span class="quality-desc">~3MB/min ‚Ä¢ Balanced</span>
          </div>
          <div class="quality-option" onclick="selectQuality('high', this)">
            <span class="quality-name">High</span>
            <span class="quality-desc">~8MB/min ‚Ä¢ Best clarity</span>
          </div>
        </div>
        
        <!-- Auto-Upload Setting -->
        <div class="section-header">
          <span class="section-title">Auto Actions</span>
        </div>
        
        <div class="auto-settings">
          <div class="auto-setting">
            <div class="auto-setting-info">
              <span class="auto-setting-icon">‚òÅÔ∏è</span>
              <div>
                <div class="auto-setting-label">Auto-Upload</div>
                <div class="auto-setting-desc">Save to secure cloud immediately</div>
              </div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="autoUpload" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="auto-setting">
            <div class="auto-setting-info">
              <span class="auto-setting-icon">üì§</span>
              <div>
                <div class="auto-setting-label">Send to Contacts</div>
                <div class="auto-setting-desc">Share with emergency contacts when done</div>
              </div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="autoSend">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
        
        <!-- Storage Info -->
        <div class="storage-info">
          <div class="storage-bar">
            <div class="storage-used" style="width: 35%"></div>
          </div>
          <div class="storage-text">
            <span>1.2 GB used</span>
            <span>2 GB available</span>
          </div>
        </div>
        
        <!-- Start Recording Button -->
        <button class="record-start-btn" onclick="startRecording()">
          <div class="record-btn-icon">‚è∫</div>
          <span>Start Recording</span>
        </button>
        
        <!-- Recent Recordings -->
        <div class="section-header" style="margin-top: 24px;">
          <span class="section-title">Recent Recordings</span>
          <span class="section-action" onclick="viewAllRecordings()">See All</span>
        </div>
        
        <div class="recordings-list" id="recordingsList">
          <div class="recording-item">
            <div class="recording-icon audio">üé§</div>
            <div class="recording-info">
              <div class="recording-name">Audio Recording</div>
              <div class="recording-meta">Today, 2:45 PM ‚Ä¢ 3:24</div>
            </div>
            <div class="recording-status uploaded">‚òÅÔ∏è</div>
            <div class="recording-actions">
              <span onclick="playRecording(1)">‚ñ∂Ô∏è</span>
              <span onclick="shareRecording(1)">üì§</span>
            </div>
          </div>
          <div class="recording-item">
            <div class="recording-icon video">üìπ</div>
            <div class="recording-info">
              <div class="recording-name">Video Recording</div>
              <div class="recording-meta">Yesterday ‚Ä¢ 1:12</div>
            </div>
            <div class="recording-status uploaded">‚òÅÔ∏è</div>
            <div class="recording-actions">
              <span onclick="playRecording(2)">‚ñ∂Ô∏è</span>
              <span onclick="shareRecording(2)">üì§</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Active Recording State -->
      <div id="recorderActive" style="display:none;">
        <div class="recording-display">
          <!-- Recording indicator -->
          <div class="recording-indicator">
            <div class="rec-dot"></div>
            <span>REC</span>
          </div>
          
          <!-- Timer -->
          <div class="recording-timer" id="recordingTimer">00:00</div>
          
          <!-- Waveform / Video preview -->
          <div class="waveform-container" id="waveformContainer">
            <div class="waveform">
              <div class="wave-bar" style="height: 20%"></div>
              <div class="wave-bar" style="height: 45%"></div>
              <div class="wave-bar" style="height: 70%"></div>
              <div class="wave-bar" style="height: 55%"></div>
              <div class="wave-bar" style="height: 85%"></div>
              <div class="wave-bar" style="height: 60%"></div>
              <div class="wave-bar" style="height: 40%"></div>
              <div class="wave-bar" style="height: 75%"></div>
              <div class="wave-bar" style="height: 50%"></div>
              <div class="wave-bar" style="height: 65%"></div>
              <div class="wave-bar" style="height: 30%"></div>
              <div class="wave-bar" style="height: 80%"></div>
              <div class="wave-bar" style="height: 45%"></div>
              <div class="wave-bar" style="height: 60%"></div>
              <div class="wave-bar" style="height: 35%"></div>
              <div class="wave-bar" style="height: 70%"></div>
              <div class="wave-bar" style="height: 55%"></div>
              <div class="wave-bar" style="height: 40%"></div>
              <div class="wave-bar" style="height: 65%"></div>
              <div class="wave-bar" style="height: 50%"></div>
            </div>
          </div>
          
          <div class="video-preview" id="videoPreview" style="display:none;">
            <div class="video-placeholder">
              <span>üìπ</span>
              <span>Camera Active</span>
            </div>
          </div>
          
          <!-- Recording info -->
          <div class="recording-meta-info">
            <div class="meta-item">
              <span class="meta-label">Type</span>
              <span class="meta-value" id="recTypeDisplay">Audio</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Quality</span>
              <span class="meta-value" id="recQualityDisplay">Medium</span>
            </div>
            <div class="meta-item">
              <span class="meta-label">Size</span>
              <span class="meta-value" id="recSizeDisplay">0 KB</span>
            </div>
          </div>
          
          <!-- Upload status -->
          <div class="upload-status" id="uploadStatus">
            <div class="upload-icon">‚òÅÔ∏è</div>
            <span>Uploading to secure cloud...</span>
            <div class="upload-progress">
              <div class="upload-progress-bar" id="uploadProgressBar"></div>
            </div>
          </div>
        </div>
        
        <!-- Recording Controls -->
        <div class="recording-controls">
          <button class="rec-control-btn pause" id="pauseBtn" onclick="togglePauseRecording()">
            <span>‚è∏</span>
            <span>Pause</span>
          </button>
          <button class="rec-control-btn stop" onclick="stopRecording()">
            <span>‚èπ</span>
            <span>Stop</span>
          </button>
          <button class="rec-control-btn send" onclick="sendRecordingNow()">
            <span>üì§</span>
            <span>Send</span>
          </button>
        </div>
        
        <!-- Emergency note -->
        <div class="rec-emergency-note">
          <span>üîí</span>
          <span>Recording is being saved. Even if app closes, your evidence is protected.</span>
        </div>
      </div>
      
      <!-- Recording Complete State -->
      <div id="recorderComplete" style="display:none;">
        <div class="complete-display">
          <div class="complete-icon">‚úÖ</div>
          <h2 class="complete-title">Recording Saved</h2>
          
          <div class="complete-preview">
            <div class="preview-icon" id="completePreviewIcon">üé§</div>
            <div class="preview-info">
              <div class="preview-duration" id="completeDuration">3:24</div>
              <div class="preview-size" id="completeSize">10.2 MB</div>
            </div>
            <button class="preview-play" onclick="playLastRecording()">‚ñ∂Ô∏è</button>
          </div>
          
          <div class="complete-status">
            <div class="status-item success">
              <span>‚òÅÔ∏è</span>
              <span>Uploaded to cloud</span>
            </div>
            <div class="status-item" id="sentStatus" style="display:none;">
              <span>üì§</span>
              <span>Sent to contacts</span>
            </div>
          </div>
          
          <div class="complete-actions">
            <button class="complete-btn primary" onclick="sendToContacts()">
              <span>üì§</span>
              <span>Send to Contacts</span>
            </button>
            <button class="complete-btn secondary" onclick="newRecording()">
              <span>üéôÔ∏è</span>
              <span>New Recording</span>
            </button>
          </div>
          
          <button class="complete-done-btn" onclick="switchScreen('homeScreen')">Done</button>
        </div>
      </div>
    </div>
    
    <!-- =============================================
         REPORT INCIDENT SCREEN
         ============================================= -->
    <div class="screen" id="reportScreen">
      <div class="status-bar">
        <span id="time7">9:41</span>
        <span>üì∂ üìç üîã</span>
      </div>
      
      <div class="screen-header">
        <div class="back-btn" onclick="switchScreen('homeScreen')">
          <span>‚Äπ</span>
          <span>Home</span>
        </div>
      </div>
      
      <h1 class="page-title">Report Security Threat</h1>
      
      <!-- Emergency Hotlines Banner -->
      <div class="emergency-hotlines">
        <div class="hotline-header">
          <span>üÜò</span>
          <span>Emergency? Call Now:</span>
        </div>
        <div class="hotline-numbers">
          <a href="tel:112" class="hotline-btn">
            <span>üìû</span>
            <span>112</span>
          </a>
          <a href="tel:199" class="hotline-btn">
            <span>üöî</span>
            <span>199</span>
          </a>
          <a href="tel:08032003913" class="hotline-btn nscdc">
            <span>üõ°Ô∏è</span>
            <span>NSCDC</span>
          </a>
        </div>
      </div>
      
      <!-- Report Form -->
      <div id="reportForm">
        <!-- Incident Type -->
        <div class="section-header">
          <span class="section-title">What happened?</span>
        </div>
        
        <div class="incident-types">
          <div class="incident-type urgent" onclick="selectIncidentType('kidnapping', this)">
            <span class="incident-icon">üö®</span>
            <span class="incident-label">Kidnapping</span>
          </div>
          <div class="incident-type urgent" onclick="selectIncidentType('terrorist', this)">
            <span class="incident-icon">üí£</span>
            <span class="incident-label">Terrorist Activity</span>
          </div>
          <div class="incident-type urgent" onclick="selectIncidentType('gunmen', this)">
            <span class="incident-icon">üî´</span>
            <span class="incident-label">Gunmen/Bandits</span>
          </div>
          <div class="incident-type urgent" onclick="selectIncidentType('onechance', this)">
            <span class="incident-icon">üöê</span>
            <span class="incident-label">One Chance</span>
          </div>
          <div class="incident-type" onclick="selectIncidentType('missing', this)">
            <span class="incident-icon">üîç</span>
            <span class="incident-label">Missing Person</span>
          </div>
          <div class="incident-type" onclick="selectIncidentType('checkpoint', this)">
            <span class="incident-icon">üöß</span>
            <span class="incident-label">Illegal Checkpoint</span>
          </div>
          <div class="incident-type" onclick="selectIncidentType('cultist', this)">
            <span class="incident-icon">‚öîÔ∏è</span>
            <span class="incident-label">Cultist/Gang</span>
          </div>
          <div class="incident-type" onclick="selectIncidentType('robbery', this)">
            <span class="incident-icon">üí∞</span>
            <span class="incident-label">Armed Robbery</span>
          </div>
          <div class="incident-type" onclick="selectIncidentType('herdsmen', this)">
            <span class="incident-icon">üêÑ</span>
            <span class="incident-label">Herdsmen Attack</span>
          </div>
          <div class="incident-type" onclick="selectIncidentType('explosion', this)">
            <span class="incident-icon">üí•</span>
            <span class="incident-label">Explosion/IED</span>
          </div>
          <div class="incident-type" onclick="selectIncidentType('shooting', this)">
            <span class="incident-icon">üéØ</span>
            <span class="incident-label">Shooting</span>
          </div>
          <div class="incident-type" onclick="selectIncidentType('other', this)">
            <span class="incident-icon">üìù</span>
            <span class="incident-label">Other Threat</span>
          </div>
        </div>
        
        <!-- Urgency Level -->
        <div class="section-header">
          <span class="section-title">Urgency Level</span>
        </div>
        
        <div class="severity-options">
          <div class="severity-option low" onclick="selectSeverity('low', this)">
            <span class="severity-dot"></span>
            <span>Past</span>
            <span class="severity-desc">Already happened</span>
          </div>
          <div class="severity-option medium selected" onclick="selectSeverity('medium', this)">
            <span class="severity-dot"></span>
            <span>Active</span>
            <span class="severity-desc">Happening now</span>
          </div>
          <div class="severity-option high" onclick="selectSeverity('high', this)">
            <span class="severity-dot"></span>
            <span>DANGER</span>
            <span class="severity-desc">Life at risk</span>
          </div>
        </div>
        
        <!-- Location -->
        <div class="section-header">
          <span class="section-title">Location</span>
        </div>
        
        <div class="location-input-group">
          <div class="location-current" onclick="useCurrentLocation()">
            <span class="location-icon">üìç</span>
            <div class="location-info">
              <div class="location-label" id="currentLocationLabel">Use Current Location</div>
              <div class="location-address" id="currentLocationAddress">Tap to detect your location</div>
            </div>
            <span class="location-check" id="locationCheck" style="display:none;">‚úì</span>
          </div>
          
          <div class="location-divider">
            <span>or enter manually</span>
          </div>
          
          <input type="text" class="location-manual-input" id="manualLocation" placeholder="e.g., Computer Village, Ikeja" oninput="onManualLocationInput()">
        </div>
        
        <!-- Description -->
        <div class="section-header">
          <span class="section-title">Description</span>
        </div>
        
        <textarea class="report-description" id="reportDescription" placeholder="Describe what you saw: number of attackers, weapons, vehicles (color, plate numbers), direction of movement, victim descriptions, etc." rows="4"></textarea>
        
        <!-- Attach Evidence -->
        <div class="section-header">
          <span class="section-title">Attach Evidence (Optional)</span>
        </div>
        
        <div class="evidence-attach">
          <div class="evidence-option" onclick="attachPhoto()">
            <span>üì∑</span>
            <span>Photo</span>
          </div>
          <div class="evidence-option" onclick="attachRecording()">
            <span>üéôÔ∏è</span>
            <span>Recording</span>
          </div>
          <div class="evidence-option" onclick="attachVideo()">
            <span>üìπ</span>
            <span>Video</span>
          </div>
        </div>
        
        <div class="attached-files" id="attachedFiles" style="display:none;">
          <!-- Attached files will appear here -->
        </div>
        
        <!-- Anonymous Toggle -->
        <div class="anonymous-toggle">
          <div class="anonymous-info">
            <span class="anonymous-icon">üé≠</span>
            <div>
              <div class="anonymous-label">Report Anonymously</div>
              <div class="anonymous-desc">Your identity will be hidden from the community</div>
            </div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="anonymousToggle" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        
        <!-- Submit Button -->
        <button class="report-submit-btn" onclick="submitReport()">
          <span>üì¢</span>
          <span>Submit Report</span>
        </button>
        
        <p class="report-disclaimer">Your report helps protect lives. False reports waste emergency resources and may result in legal action.</p>
      </div>
      
      <!-- Report Submitted State -->
      <div id="reportSubmitted" style="display:none;">
        <div class="submitted-display">
          <div class="submitted-icon">‚úÖ</div>
          <h2 class="submitted-title">Report Submitted</h2>
          <p class="submitted-text">Your report is being shared with security agencies and the community. This could save lives.</p>
          
          <div class="submitted-card">
            <div class="submitted-card-header">
              <span class="submitted-type-icon" id="submittedTypeIcon">üî´</span>
              <div>
                <div class="submitted-type" id="submittedType">Armed Robbery</div>
                <div class="submitted-location" id="submittedLocation">Computer Village, Ikeja</div>
              </div>
              <span class="submitted-severity" id="submittedSeverity">High</span>
            </div>
            <div class="submitted-desc" id="submittedDesc">Incident description will appear here...</div>
            <div class="submitted-meta">
              <span>üïê Just now</span>
              <span id="submittedAnon">üé≠ Anonymous</span>
            </div>
          </div>
          
          <div class="submitted-stats">
            <div class="stat-item">
              <span class="stat-value">2,847</span>
              <span class="stat-label">People will see this</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">~5 min</span>
              <span class="stat-label">Review time</span>
            </div>
          </div>
          
          <div class="submitted-actions">
            <button class="submitted-btn primary" onclick="shareReport()">
              <span>üì§</span>
              <span>Share to WhatsApp</span>
            </button>
            <button class="submitted-btn secondary" onclick="newReport()">
              <span>üì¢</span>
              <span>New Report</span>
            </button>
          </div>
          
          <button class="submitted-done-btn" onclick="switchScreen('homeScreen')">Done</button>
        </div>
      </div>
    </div>
    
    <!-- =============================================
         SETTINGS SCREEN
         ============================================= -->
    <div class="screen" id="settingsScreen">
      <div class="status-bar">
        <span id="time4">9:41</span>
        <span>üì∂ üìç üîã</span>
      </div>
      
      <h1 class="page-title">Settings</h1>
      
      <div class="settings-group">
        <div class="settings-group-title">Account</div>
        <div class="settings-item">
          <div class="settings-icon" style="background: rgba(100,210,255,0.15)">üë§</div>
          <div class="settings-info">
            <div class="settings-label">Personal Info</div>
            <div class="settings-desc">Name, phone, location</div>
          </div>
          <span class="settings-arrow">‚Ä∫</span>
        </div>
        <div class="settings-item">
          <div class="settings-icon" style="background: rgba(50,215,75,0.15)">üë•</div>
          <div class="settings-info">
            <div class="settings-label">Emergency Contacts</div>
            <div class="settings-desc">3 contacts saved</div>
          </div>
          <span class="settings-arrow">‚Ä∫</span>
        </div>
        <div class="settings-item">
          <div class="settings-icon" style="background: rgba(191,90,242,0.15)">‚≠ê</div>
          <div class="settings-info">
            <div class="settings-label">SafeAlert Premium</div>
            <div class="settings-desc">Unlock all features</div>
          </div>
          <span class="settings-arrow">‚Ä∫</span>
        </div>
      </div>
      
      <div class="settings-group">
        <div class="settings-group-title">Preferences</div>
        <div class="settings-item">
          <div class="settings-icon" style="background: rgba(255,159,10,0.15)">üåê</div>
          <div class="settings-info">
            <div class="settings-label">Language</div>
            <div class="settings-desc">English</div>
          </div>
          <span class="settings-arrow">‚Ä∫</span>
        </div>
        <div class="settings-item">
          <div class="settings-icon" style="background: rgba(100,210,255,0.15)">üîî</div>
          <div class="settings-info">
            <div class="settings-label">Notifications</div>
            <div class="settings-desc">Alerts, check-ins, updates</div>
          </div>
          <span class="settings-arrow">‚Ä∫</span>
        </div>
        <div class="settings-item">
          <div class="settings-icon" style="background: rgba(50,215,75,0.15)">üìç</div>
          <div class="settings-info">
            <div class="settings-label">Location Settings</div>
            <div class="settings-desc">Background tracking enabled</div>
          </div>
          <span class="settings-arrow">‚Ä∫</span>
        </div>
      </div>
      
      <div class="settings-group">
        <div class="settings-group-title">About</div>
        <div class="settings-item">
          <div class="settings-icon" style="background: rgba(100,210,255,0.15)">üìñ</div>
          <div class="settings-info">
            <div class="settings-label">How SafeAlert Works</div>
          </div>
          <span class="settings-arrow">‚Ä∫</span>
        </div>
        <div class="settings-item">
          <div class="settings-icon" style="background: rgba(191,90,242,0.15)">üîí</div>
          <div class="settings-info">
            <div class="settings-label">Privacy Policy</div>
            <div class="settings-desc">NDPR Compliant</div>
          </div>
          <span class="settings-arrow">‚Ä∫</span>
        </div>
      </div>
      
      <div class="footer">
        <div class="footer-badge">
          üá≥üá¨ SafeAlert v1.0 ‚Ä¢ Made in Nigeria
        </div>
      </div>
    </div>
    
  </div>
  
  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <div class="nav-item active" onclick="switchScreen('homeScreen')" id="navHome">
      <span class="nav-icon">üè†</span>
      <span class="nav-label">Home</span>
    </div>
    <div class="nav-item" onclick="switchScreen('mapScreen')" id="navMap">
      <span class="nav-icon">üó∫Ô∏è</span>
      <span class="nav-label">Map</span>
    </div>
    <div class="nav-item" onclick="switchScreen('hubScreen')" id="navHub">
      <span class="nav-icon">üìä</span>
      <span class="nav-label">Hub</span>
    </div>
    <div class="nav-item" onclick="switchScreen('settingsScreen')" id="navSettings">
      <span class="nav-icon">‚öôÔ∏è</span>
      <span class="nav-label">Settings</span>
    </div>
  </nav>
  
  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-box" id="modalBox"></div>
  </div>

  <script>
    // =============================================
    // SCREEN NAVIGATION
    // =============================================
    function switchScreen(screenId) {
      document.querySelectorAll('.screen').forEach(function(s) {
        s.classList.remove('active');
      });
      document.getElementById(screenId).classList.add('active');
      
      document.querySelectorAll('.nav-item').forEach(function(n) {
        n.classList.remove('active');
      });
      
      if (screenId === 'homeScreen') document.getElementById('navHome').classList.add('active');
      if (screenId === 'mapScreen') document.getElementById('navMap').classList.add('active');
      if (screenId === 'hubScreen') document.getElementById('navHub').classList.add('active');
      if (screenId === 'settingsScreen') document.getElementById('navSettings').classList.add('active');
      if (screenId === 'checkinScreen') document.getElementById('navHome').classList.add('active');
      if (screenId === 'recordScreen') document.getElementById('navHome').classList.add('active');
      if (screenId === 'reportScreen') document.getElementById('navHome').classList.add('active');
    }
    
    // =============================================
    // UPDATE CLOCK (all screens)
    // =============================================
    function updateClock() {
      var now = new Date();
      var h = now.getHours();
      var m = String(now.getMinutes()).padStart(2, '0');
      var timeStr = h + ':' + m;
      for (var i = 1; i <= 15; i++) {
        var el = document.getElementById('time' + (i === 1 ? '' : i));
        if (el) el.textContent = timeStr;
      }
    }
    updateClock();
    setInterval(updateClock, 60000);
    
    // =============================================
    // HUB TAB SWITCHING
    // =============================================
    function switchHubTab(tab) {
      document.querySelectorAll('.hub-tab').forEach(function(t) {
        t.classList.remove('active');
      });
      document.querySelectorAll('.hub-content').forEach(function(c) {
        c.classList.remove('active');
      });
      
      if (tab === 'community') {
        document.querySelector('.hub-tab:first-child').classList.add('active');
        document.getElementById('communityContent').classList.add('active');
      } else {
        document.querySelector('.hub-tab:last-child').classList.add('active');
        document.getElementById('historyContent').classList.add('active');
      }
    }
    
    // =============================================
    // MAP FUNCTIONALITY
    // =============================================
    var mapZoom = 1;
    var mapPanX = 0;
    var mapPanY = 0;
    var isDragging = false;
    var dragStartX = 0;
    var dragStartY = 0;
    var lastPanX = 0;
    var lastPanY = 0;
    
    var tripActive = false;
    var tripProgress = 0;
    var tripInterval = null;
    var destX = 300;
    var destY = 520;
    var startX = 200;
    var startY = 300;
    
    // Marker data
    var markers = {
      1: {
        type: 'danger',
        title: 'Armed Robbery',
        location: 'Computer Village, Ikeja',
        time: '18 minutes ago',
        desc: 'Armed robbery reported near the main market area. Multiple victims reported. Police have been dispatched to the scene.'
      },
      2: {
        type: 'warning',
        title: 'Suspicious Activity',
        location: 'Maryland, Lagos',
        time: '45 minutes ago',
        desc: 'Suspicious individuals spotted near the bus stop. Residents advised to be vigilant and report any unusual behavior.'
      },
      3: {
        type: 'warning',
        title: 'Traffic Congestion',
        location: 'Oshodi Expressway',
        time: '1 hour ago',
        desc: 'Heavy traffic due to broken down truck. Expect delays of 30-45 minutes. Consider alternative routes.'
      },
      4: {
        type: 'safe',
        title: 'Police Checkpoint',
        location: 'Lekki Toll Gate',
        time: 'Active now',
        desc: 'Police checkpoint active. Routine checks in progress. Safe zone with security presence.'
      }
    };
    
    // Location coordinates
    var locations = {
      'ikeja': { x: 130, y: 120, name: 'Ikeja' },
      'vi': { x: 300, y: 440, name: 'Victoria Island' },
      'lekki': { x: 350, y: 560, name: 'Lekki' },
      'yaba': { x: 270, y: 130, name: 'Yaba' },
      'ikoyi': { x: 240, y: 530, name: 'Ikoyi' },
      'surulere': { x: 100, y: 230, name: 'Surulere' },
      'maryland': { x: 330, y: 270, name: 'Maryland' },
      'oshodi': { x: 110, y: 410, name: 'Oshodi' }
    };
    
    // =============================================
    // ZOOM FUNCTIONS
    // =============================================
    function updateMapTransform() {
      var svg = document.getElementById('mapSvg');
      var content = document.getElementById('mapContent');
      if (content) {
        content.setAttribute('transform', 'translate(' + mapPanX + ',' + mapPanY + ') scale(' + mapZoom + ')');
      }
    }
    
    function showZoomIndicator() {
      var indicator = document.getElementById('zoomIndicator');
      indicator.textContent = Math.round(mapZoom * 100) + '%';
      indicator.classList.add('show');
      clearTimeout(window.zoomTimeout);
      window.zoomTimeout = setTimeout(function() {
        indicator.classList.remove('show');
      }, 1500);
    }
    
    function zoomIn() {
      if (mapZoom < 3) {
        mapZoom = Math.min(3, mapZoom + 0.25);
        updateMapTransform();
        showZoomIndicator();
      }
    }
    
    function zoomOut() {
      if (mapZoom > 0.5) {
        mapZoom = Math.max(0.5, mapZoom - 0.25);
        // Reset pan if zooming out
        if (mapZoom <= 1) {
          mapPanX = 0;
          mapPanY = 0;
        }
        updateMapTransform();
        showZoomIndicator();
      }
    }
    
    function centerOnUser() {
      var svg = document.getElementById('mapSvg');
      svg.classList.add('animating');
      mapZoom = 1.5;
      mapPanX = -startX * 0.5 + 100;
      mapPanY = -startY * 0.5 + 150;
      updateMapTransform();
      showZoomIndicator();
      
      document.getElementById('centerBtn').classList.add('active');
      setTimeout(function() {
        svg.classList.remove('animating');
        document.getElementById('centerBtn').classList.remove('active');
      }, 500);
    }
    
    function toggleMapStyle() {
      var btn = document.getElementById('styleBtn');
      btn.classList.toggle('active');
      // Toggle between map styles (placeholder)
      showToast('Map style changed');
    }
    
    // =============================================
    // PAN FUNCTIONS (TOUCH & MOUSE)
    // =============================================
    function initMapDrag() {
      var container = document.getElementById('mapContainer');
      
      container.addEventListener('pointerdown', function(e) {
        if (e.target.closest('.map-controls') || e.target.closest('.trip-panel') || 
            e.target.closest('.start-trip-panel') || e.target.closest('.marker-popup') ||
            e.target.closest('.map-legend') || e.target.closest('.map-search')) return;
        
        isDragging = true;
        dragStartX = e.clientX;
        dragStartY = e.clientY;
        lastPanX = mapPanX;
        lastPanY = mapPanY;
        container.style.cursor = 'grabbing';
      });
      
      container.addEventListener('pointermove', function(e) {
        if (!isDragging) return;
        
        var dx = (e.clientX - dragStartX) / mapZoom;
        var dy = (e.clientY - dragStartY) / mapZoom;
        
        mapPanX = lastPanX + dx;
        mapPanY = lastPanY + dy;
        
        // Limit panning
        var maxPan = 200 * mapZoom;
        mapPanX = Math.max(-maxPan, Math.min(maxPan, mapPanX));
        mapPanY = Math.max(-maxPan, Math.min(maxPan, mapPanY));
        
        updateMapTransform();
      });
      
      container.addEventListener('pointerup', function() {
        isDragging = false;
        container.style.cursor = 'grab';
      });
      
      container.addEventListener('pointerleave', function() {
        isDragging = false;
        container.style.cursor = 'grab';
      });
      
      // Mouse wheel zoom
      container.addEventListener('wheel', function(e) {
        e.preventDefault();
        if (e.deltaY < 0) {
          zoomIn();
        } else {
          zoomOut();
        }
      }, { passive: false });
    }
    
    // =============================================
    // SEARCH FUNCTIONS
    // =============================================
    function showSearchSuggestions() {
      document.getElementById('searchSuggestions').classList.add('show');
      document.querySelector('.search-clear').style.display = 'block';
    }
    
    function clearSearch() {
      document.getElementById('mapSearchInput').value = '';
      document.getElementById('searchSuggestions').classList.remove('show');
      document.querySelector('.search-clear').style.display = 'none';
    }
    
    function filterSuggestions() {
      var input = document.getElementById('mapSearchInput').value.toLowerCase();
      var items = document.querySelectorAll('.suggestion-item');
      
      items.forEach(function(item) {
        var name = item.querySelector('.suggestion-name').textContent.toLowerCase();
        if (name.includes(input) || input === '') {
          item.style.display = 'flex';
        } else {
          item.style.display = 'none';
        }
      });
    }
    
    function goToLocation(locKey) {
      var loc = locations[locKey];
      if (!loc) return;
      
      clearSearch();
      
      var svg = document.getElementById('mapSvg');
      svg.classList.add('animating');
      
      mapZoom = 1.5;
      mapPanX = -loc.x * 0.5 + 100;
      mapPanY = -loc.y * 0.5 + 150;
      updateMapTransform();
      
      setTimeout(function() {
        svg.classList.remove('animating');
      }, 400);
      
      showToast('üìç ' + loc.name);
    }
    
    // Close search when clicking outside
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.map-search')) {
        document.getElementById('searchSuggestions').classList.remove('show');
      }
    });
    
    // =============================================
    // MARKER FUNCTIONS
    // =============================================
    function showMarkerInfo(id) {
      var marker = markers[id];
      if (!marker) return;
      
      var popup = document.getElementById('markerPopup');
      var badge = document.getElementById('popupBadge');
      
      // Set badge
      if (marker.type === 'danger') {
        badge.textContent = 'üö® High Alert';
        badge.className = 'popup-badge danger';
      } else if (marker.type === 'warning') {
        badge.textContent = '‚ö†Ô∏è Caution';
        badge.className = 'popup-badge warning';
      } else {
        badge.textContent = '‚úì Safe Zone';
        badge.className = 'popup-badge safe';
      }
      
      document.getElementById('popupTitle').textContent = marker.title;
      document.getElementById('popupLocation').textContent = 'üìç ' + marker.location;
      document.getElementById('popupTime').textContent = marker.time;
      document.getElementById('popupDesc').textContent = marker.desc;
      
      popup.classList.add('show');
      document.getElementById('mapLegend').style.display = 'none';
    }
    
    function hideMarkerInfo() {
      document.getElementById('markerPopup').classList.remove('show');
      document.getElementById('mapLegend').style.display = 'block';
    }
    
    function navigateToAlert() {
      hideMarkerInfo();
      showToast('üß≠ Navigation started');
    }
    
    function shareAlert() {
      hideMarkerInfo();
      showToast('üì§ Alert shared');
    }
    
    // =============================================
    // TRIP MONITORING
    // =============================================
    function toggleTripPanel() {
      var panel = document.getElementById('startTripPanel');
      var toggle = document.getElementById('startTripToggle');
      
      if (panel.classList.contains('hidden')) {
        panel.classList.remove('hidden');
        toggle.classList.add('hidden');
      } else {
        panel.classList.add('hidden');
        toggle.classList.remove('hidden');
      }
    }
    
    function selectDestination(name, x, y) {
      document.getElementById('destInput').value = name;
      destX = x;
      destY = y;
    }
    
    function startTrip() {
      var destination = document.getElementById('destInput').value || 'Victoria Island';
      
      // Find destination coords
      var destKey = destination.toLowerCase().replace(' ', '');
      if (locations[destKey]) {
        destX = locations[destKey].x;
        destY = locations[destKey].y;
      }
      
      tripActive = true;
      tripProgress = 0;
      
      document.getElementById('tripDest').textContent = destination;
      document.getElementById('startTripPanel').classList.add('hidden');
      document.getElementById('startTripToggle').classList.add('hidden');
      document.getElementById('tripPanel').classList.remove('hidden');
      
      // Show route
      var routePath = 'M' + startX + ',' + startY + ' Q' + ((startX + destX) / 2 + 20) + ',' + ((startY + destY) / 2) + ' ' + destX + ',' + destY;
      document.getElementById('routePath').setAttribute('d', routePath);
      document.getElementById('routeGlow').setAttribute('d', routePath);
      document.getElementById('routeTraveled').setAttribute('d', routePath);
      
      document.getElementById('routePath').style.display = 'block';
      document.getElementById('routeGlow').style.display = 'block';
      document.getElementById('routeTraveled').style.display = 'block';
      document.getElementById('destMarker').style.display = 'block';
      document.getElementById('userDirection').style.display = 'block';
      
      // Animate route drawing
      var routeEl = document.getElementById('routePath');
      routeEl.style.strokeDashoffset = '0';
      
      // Position destination marker
      document.getElementById('destMarker').setAttribute('transform', 'translate(' + destX + ',' + destY + ')');
      
      // Update island
      document.getElementById('island').classList.add('trip-active');
      document.querySelector('.island-icon').textContent = 'üìç';
      document.querySelector('.island-title').textContent = 'Trip Active';
      document.querySelector('.island-title').style.color = '#64D2FF';
      document.querySelector('.island-sub').textContent = 'To ' + destination + ' ‚Ä¢ 3 watching';
      
      // Center map on route
      var svg = document.getElementById('mapSvg');
      svg.classList.add('animating');
      mapZoom = 1.2;
      mapPanX = -((startX + destX) / 2) * 0.2 + 50;
      mapPanY = -((startY + destY) / 2) * 0.2 + 50;
      updateMapTransform();
      setTimeout(function() { svg.classList.remove('animating'); }, 400);
      
      // Start trip simulation
      simulateTrip();
    }
    
    function simulateTrip() {
      var totalDistance = 4.2;
      var totalTime = 12;
      
      tripInterval = setInterval(function() {
        if (!tripActive) {
          clearInterval(tripInterval);
          return;
        }
        
        tripProgress += 0.5;
        if (tripProgress > 100) tripProgress = 100;
        
        // Update stats
        var remainingDist = (totalDistance * (100 - tripProgress) / 100).toFixed(1);
        var remainingTime = Math.ceil(totalTime * (100 - tripProgress) / 100);
        
        document.getElementById('tripDistance').textContent = remainingDist;
        document.getElementById('tripEta').textContent = remainingTime;
        
        // Update progress ring
        var circumference = 125.6;
        var offset = circumference - (tripProgress / 100 * circumference);
        document.getElementById('progressRing').style.strokeDashoffset = offset;
        document.getElementById('progressPercent').textContent = Math.round(tripProgress) + '%';
        
        // Move user marker along route
        var currentX = startX + (destX - startX) * tripProgress / 100;
        var currentY = startY + (destY - startY) * tripProgress / 100;
        document.getElementById('userMarker').setAttribute('transform', 'translate(' + currentX + ',' + currentY + ')');
        
        // Update traveled route
        var traveledLength = tripProgress * 10;
        document.getElementById('routeTraveled').style.strokeDasharray = traveledLength + ' 1000';
        
        // Trip complete
        if (tripProgress >= 100) {
          clearInterval(tripInterval);
          showToast('üéâ You have arrived!');
          try { navigator.vibrate([100, 50, 100]); } catch(e) {}
        }
      }, 300);
    }
    
    function sendCheckIn() {
      showToast('‚úì Check-in sent to 3 watchers');
      try { navigator.vibrate(50); } catch(e) {}
    }
    
    function endTrip() {
      tripActive = false;
      if (tripInterval) clearInterval(tripInterval);
      
      document.getElementById('startTripPanel').classList.remove('hidden');
      document.getElementById('tripPanel').classList.add('hidden');
      
      // Hide route
      document.getElementById('routePath').style.display = 'none';
      document.getElementById('routeGlow').style.display = 'none';
      document.getElementById('routeTraveled').style.display = 'none';
      document.getElementById('destMarker').style.display = 'none';
      document.getElementById('userDirection').style.display = 'none';
      
      // Reset route animation
      document.getElementById('routePath').style.strokeDashoffset = '1000';
      document.getElementById('routeTraveled').style.strokeDasharray = '0 1000';
      
      // Reset user position
      startX = 200;
      startY = 300;
      document.getElementById('userMarker').setAttribute('transform', 'translate(' + startX + ',' + startY + ')');
      
      // Reset island
      document.getElementById('island').classList.remove('trip-active');
      document.querySelector('.island-title').style.color = '#FF375F';
      
      // Reset progress
      tripProgress = 0;
      document.getElementById('progressRing').style.strokeDashoffset = '125.6';
      document.getElementById('progressPercent').textContent = '0%';
      
      showToast('Trip ended safely');
    }
    
    function shareTrip() {
      showToast('üì§ Trip link copied!');
    }
    
    // =============================================
    // TOAST NOTIFICATION
    // =============================================
    function showToast(message) {
      var toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      
      setTimeout(function() {
        toast.classList.remove('show');
      }, 2500);
    }
    
    // Initialize map drag when page loads
    document.addEventListener('DOMContentLoaded', function() {
      initMapDrag();
    });
    
    // Also init immediately in case DOM is already ready
    if (document.readyState !== 'loading') {
      initMapDrag();
    }
    
    // =============================================
    // CHECK-IN TIMER
    // =============================================
    var checkinDuration = 30; // minutes
    var checkinReason = '';
    var checkinTimeLeft = 0; // seconds
    var checkinInterval = null;
    var checkinActive = false;
    var expiredInterval = null;
    var expiredSeconds = 10;
    
    function selectDuration(minutes, element) {
      checkinDuration = minutes;
      
      // Update UI
      document.querySelectorAll('.duration-option').forEach(function(el) {
        el.classList.remove('selected');
      });
      element.classList.add('selected');
      
      // Clear custom input
      document.getElementById('customMinutes').value = '';
    }
    
    function setCustomDuration() {
      var custom = parseInt(document.getElementById('customMinutes').value);
      if (custom && custom >= 5 && custom <= 480) {
        checkinDuration = custom;
        
        // Deselect preset options
        document.querySelectorAll('.duration-option').forEach(function(el) {
          el.classList.remove('selected');
        });
        
        showHomeToast('Timer set to ' + custom + ' minutes');
      } else {
        showHomeToast('Enter 5-480 minutes');
      }
    }
    
    function selectReason(reason, element) {
      // Toggle selection
      if (element.classList.contains('selected')) {
        element.classList.remove('selected');
        checkinReason = '';
        document.getElementById('reasonInputWrap').style.display = 'none';
        return;
      }
      
      // Update UI
      document.querySelectorAll('.reason-chip').forEach(function(el) {
        el.classList.remove('selected');
      });
      element.classList.add('selected');
      
      if (reason === 'Other') {
        document.getElementById('reasonInputWrap').style.display = 'block';
        checkinReason = '';
      } else {
        document.getElementById('reasonInputWrap').style.display = 'none';
        checkinReason = reason;
      }
    }
    
    function startCheckinTimer() {
      // Get custom reason if "Other" selected
      if (document.getElementById('reasonInputWrap').style.display === 'block') {
        checkinReason = document.getElementById('customReason').value || 'Other activity';
      }
      
      checkinActive = true;
      checkinTimeLeft = checkinDuration * 60; // convert to seconds
      
      // Update UI
      document.getElementById('checkinSetup').style.display = 'none';
      document.getElementById('checkinActive').style.display = 'block';
      document.getElementById('checkinExpired').style.display = 'none';
      
      // Set reason display
      if (checkinReason) {
        document.getElementById('timerReasonDisplay').style.display = 'flex';
        document.getElementById('activeReason').textContent = checkinReason;
      } else {
        document.getElementById('timerReasonDisplay').style.display = 'none';
      }
      
      // Update Dynamic Island
      document.getElementById('island').classList.add('trip-active');
      document.getElementById('island').classList.remove('expanded');
      document.querySelector('.island-icon').textContent = '‚è±Ô∏è';
      document.querySelector('.island-icon').style.background = '#FF9F0A';
      document.querySelector('.island-title').textContent = 'Timer Active';
      document.querySelector('.island-title').style.color = '#FF9F0A';
      document.querySelector('.island-sub').textContent = formatTime(checkinTimeLeft) + ' remaining';
      
      // Start countdown
      updateTimerDisplay();
      checkinInterval = setInterval(function() {
        checkinTimeLeft--;
        updateTimerDisplay();
        
        // Update island
        document.querySelector('.island-sub').textContent = formatTime(checkinTimeLeft) + ' remaining';
        
        // Warning at 1 minute
        if (checkinTimeLeft === 60) {
          try { navigator.vibrate([100, 50, 100, 50, 100]); } catch(e) {}
          document.getElementById('checkinConfirmBtn').classList.add('pulse');
        }
        
        // Warning at 30 seconds
        if (checkinTimeLeft === 30) {
          try { navigator.vibrate([200, 100, 200, 100, 200]); } catch(e) {}
        }
        
        // Timer expired
        if (checkinTimeLeft <= 0) {
          clearInterval(checkinInterval);
          checkinInterval = null;
          timerExpired();
        }
      }, 1000);
      
      try { navigator.vibrate(100); } catch(e) {}
    }
    
    function formatTime(seconds) {
      var mins = Math.floor(seconds / 60);
      var secs = seconds % 60;
      return String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');
    }
    
    function updateTimerDisplay() {
      document.getElementById('timerDisplay').textContent = formatTime(checkinTimeLeft);
      
      // Update ring
      var totalSeconds = checkinDuration * 60;
      var progress = checkinTimeLeft / totalSeconds;
      var circumference = 628; // 2 * PI * 100
      var offset = circumference * (1 - progress);
      document.getElementById('timerRing').style.strokeDashoffset = offset;
      
      // Change color when low
      if (checkinTimeLeft <= 60) {
        document.getElementById('timerRing').style.stroke = '#FF375F';
        document.getElementById('timerDisplay').style.color = '#FF375F';
      } else {
        document.getElementById('timerRing').style.stroke = '#FF9F0A';
        document.getElementById('timerDisplay').style.color = '#FF9F0A';
      }
    }
    
    function confirmCheckin() {
      // Reset timer to original duration
      checkinTimeLeft = checkinDuration * 60;
      
      document.getElementById('checkinConfirmBtn').classList.remove('pulse');
      
      // Visual feedback
      var btn = document.getElementById('checkinConfirmBtn');
      btn.innerHTML = '<span class="checkin-icon">‚úì</span><span>Checked In!</span>';
      btn.style.background = 'linear-gradient(135deg, #32D74B, #28a745)';
      
      setTimeout(function() {
        btn.innerHTML = '<span class="checkin-icon">‚úì</span><span>I\'m Safe - Check In</span>';
      }, 1500);
      
      try { navigator.vibrate([50, 30, 50]); } catch(e) {}
      showHomeToast('‚úì Check-in confirmed! Timer reset.');
      
      updateTimerDisplay();
    }
    
    function extendTimer(minutes) {
      var addMinutes = minutes || 5;
      checkinTimeLeft += addMinutes * 60;
      
      // Update total duration for ring calculation
      checkinDuration = Math.ceil(checkinTimeLeft / 60);
      
      updateTimerDisplay();
      try { navigator.vibrate(50); } catch(e) {}
      showHomeToast('+' + addMinutes + ' minutes added');
      
      // Remove warning state if we're above 1 minute
      if (checkinTimeLeft > 60) {
        document.getElementById('checkinConfirmBtn').classList.remove('pulse');
      }
    }
    
    function cancelCheckinTimer() {
      checkinActive = false;
      if (checkinInterval) {
        clearInterval(checkinInterval);
        checkinInterval = null;
      }
      
      // Reset UI
      document.getElementById('checkinSetup').style.display = 'block';
      document.getElementById('checkinActive').style.display = 'none';
      document.getElementById('checkinExpired').style.display = 'none';
      
      // Reset island
      document.getElementById('island').classList.remove('trip-active');
      document.querySelector('.island-icon').style.background = '#FF375F';
      document.querySelector('.island-title').style.color = '#FF375F';
      
      // Reset button state
      document.getElementById('checkinConfirmBtn').classList.remove('pulse');
      document.getElementById('timerRing').style.stroke = '#FF9F0A';
      document.getElementById('timerDisplay').style.color = '#FF9F0A';
      
      showHomeToast('Timer cancelled');
    }
    
    function timerExpired() {
      checkinActive = false;
      expiredSeconds = 10;
      
      // Show expired state
      document.getElementById('checkinActive').style.display = 'none';
      document.getElementById('checkinExpired').style.display = 'block';
      
      // Update island
      document.getElementById('island').classList.remove('trip-active');
      document.getElementById('island').classList.add('expanded');
      document.querySelector('.island-icon').textContent = 'üö®';
      document.querySelector('.island-icon').style.background = '#FF375F';
      document.querySelector('.island-title').textContent = 'Missed Check-In!';
      document.querySelector('.island-title').style.color = '#FF375F';
      document.querySelector('.island-sub').textContent = 'Alerting contacts...';
      
      // Update home screen
      document.getElementById('glow').classList.add('danger');
      
      // Vibrate urgently
      try { navigator.vibrate([500, 200, 500, 200, 500]); } catch(e) {}
      
      // Countdown to alert
      expiredInterval = setInterval(function() {
        expiredSeconds--;
        document.getElementById('expiredSeconds').textContent = expiredSeconds;
        
        try { navigator.vibrate(100); } catch(e) {}
        
        if (expiredSeconds <= 0) {
          clearInterval(expiredInterval);
          expiredInterval = null;
          sendMissedCheckinAlert();
        }
      }, 1000);
    }
    
    function imSafeCancel() {
      if (expiredInterval) {
        clearInterval(expiredInterval);
        expiredInterval = null;
      }
      
      // Reset everything
      document.getElementById('checkinSetup').style.display = 'block';
      document.getElementById('checkinExpired').style.display = 'none';
      
      // Reset island
      document.getElementById('island').classList.remove('expanded');
      document.querySelector('.island-icon').style.background = '#FF375F';
      
      // Reset home glow
      document.getElementById('glow').classList.remove('danger');
      
      showHomeToast('‚úì Alert cancelled - You\'re marked safe');
    }
    
    function sendMissedCheckinAlert() {
      // This would send actual alerts in production
      // For now, show the emergency sent state
      
      document.getElementById('checkinExpired').innerHTML = 
        '<div class="expired-display">' +
          '<div class="expired-icon">üì§</div>' +
          '<h2 class="expired-title" style="color:#FF9F0A">Alerts Sent!</h2>' +
          '<p class="expired-text">Emergency alerts have been sent to all your contacts with your last known location.</p>' +
          '<div class="sent" style="text-align:left; margin-bottom:10px;"><span class="sent-icon">üì±</span><div><div class="sent-name">Mama</div><div class="sent-status">‚úì SMS sent ‚Ä¢ Call initiated</div></div></div>' +
          '<div class="sent" style="text-align:left; margin-bottom:10px;"><span class="sent-icon">üè†</span><div><div class="sent-name">Alhaji Danfodio</div><div class="sent-status">‚úì SMS sent</div></div></div>' +
          '<div class="sent" style="text-align:left; margin-bottom:20px;"><span class="sent-icon">üõ°Ô∏è</span><div><div class="sent-name">Area Security</div><div class="sent-status">‚úì SMS sent</div></div></div>' +
          '<button class="checkin-safe-btn" onclick="resetCheckinAfterAlert()"><span>‚úì</span><span>I\'m Safe Now</span></button>' +
        '</div>';
    }
    
    function resetCheckinAfterAlert() {
      // Reset everything
      document.getElementById('checkinSetup').style.display = 'block';
      document.getElementById('checkinExpired').style.display = 'none';
      
      // Rebuild expired state HTML for next time
      document.getElementById('checkinExpired').innerHTML = 
        '<div class="expired-display">' +
          '<div class="expired-icon">üö®</div>' +
          '<h2 class="expired-title">Timer Expired!</h2>' +
          '<p class="expired-text">You didn\'t check in. Emergency alerts are being sent to your contacts.</p>' +
          '<div class="expired-countdown">' +
            '<span>Sending alerts in</span>' +
            '<span class="expired-seconds" id="expiredSeconds">10</span>' +
            '<span>seconds</span>' +
          '</div>' +
          '<button class="checkin-safe-btn" onclick="imSafeCancel()"><span>‚úì</span><span>I\'m Safe - Cancel Alert</span></button>' +
        '</div>';
      
      // Reset island
      document.getElementById('island').classList.remove('expanded');
      document.querySelector('.island-icon').style.background = '#FF375F';
      
      // Reset home glow
      document.getElementById('glow').classList.remove('danger');
      
      showHomeToast('Contacts notified you\'re safe');
    }
    
    function showHomeToast(message) {
      // Create or use existing toast on current screen
      var existingToast = document.querySelector('.home-toast');
      if (!existingToast) {
        existingToast = document.createElement('div');
        existingToast.className = 'home-toast';
        existingToast.style.cssText = 'position:fixed;top:100px;left:50%;transform:translateX(-50%) translateY(-20px);background:rgba(50,215,75,0.95);color:#000;padding:12px 24px;border-radius:30px;font-size:14px;font-weight:600;opacity:0;transition:all 0.3s;z-index:100;white-space:nowrap;';
        document.body.appendChild(existingToast);
      }
      
      existingToast.textContent = message;
      existingToast.style.opacity = '1';
      existingToast.style.transform = 'translateX(-50%) translateY(0)';
      
      setTimeout(function() {
        existingToast.style.opacity = '0';
        existingToast.style.transform = 'translateX(-50%) translateY(-20px)';
      }, 2500);
    }
    

    // =============================================
    // EVIDENCE RECORDER (REAL AUDIO)
    // =============================================
    var recordType = 'audio';
    var recordQuality = 'medium';
    var isRecording = false;
    var isPaused = false;
    var recordingSeconds = 0;
    var recordingInterval = null;
    var uploadProgress = 0;
    var stealthMode = false;
    
    // Real recording variables
    var mediaRecorder = null;
    var audioChunks = [];
    var recordedBlob = null;
    var audioStream = null;
    var recordings = []; // Store all recordings
    
    function selectRecordType(type) {
      recordType = type;
      
      document.getElementById('audioType').classList.remove('active');
      document.getElementById('videoType').classList.remove('active');
      document.getElementById(type + 'Type').classList.add('active');
      
      if (type === 'video') {
        showHomeToast('Video recording requires camera permission');
      }
    }
    
    function selectQuality(quality, element) {
      recordQuality = quality;
      
      document.querySelectorAll('.quality-option').forEach(function(el) {
        el.classList.remove('selected');
      });
      element.classList.add('selected');
    }
    
    function toggleStealthMode() {
      stealthMode = !stealthMode;
      var toggle = document.querySelector('.stealth-toggle');
      
      if (stealthMode) {
        toggle.classList.add('active');
        document.getElementById('stealthIcon').textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è';
        document.getElementById('stealthLabel').textContent = 'Stealth On';
        showHomeToast('Stealth mode: Screen dims while recording');
      } else {
        toggle.classList.remove('active');
        document.getElementById('stealthIcon').textContent = 'üëÅÔ∏è';
        document.getElementById('stealthLabel').textContent = 'Stealth';
      }
    }
    
    async function startRecording() {
      try {
        // Request microphone permission
        var constraints = { audio: true };
        if (recordType === 'video') {
          constraints.video = { facingMode: 'environment' };
        }
        
        audioStream = await navigator.mediaDevices.getUserMedia(constraints);
        
        // Determine audio format
        var options = {};
        if (MediaRecorder.isTypeSupported('audio/webm;codecs=opus')) {
          options.mimeType = 'audio/webm;codecs=opus';
        } else if (MediaRecorder.isTypeSupported('audio/webm')) {
          options.mimeType = 'audio/webm';
        } else if (MediaRecorder.isTypeSupported('audio/mp4')) {
          options.mimeType = 'audio/mp4';
        }
        
        // Set bitrate based on quality
        if (recordQuality === 'low') {
          options.audioBitsPerSecond = 32000;
        } else if (recordQuality === 'medium') {
          options.audioBitsPerSecond = 128000;
        } else {
          options.audioBitsPerSecond = 256000;
        }
        
        mediaRecorder = new MediaRecorder(audioStream, options);
        audioChunks = [];
        
        mediaRecorder.ondataavailable = function(event) {
          if (event.data.size > 0) {
            audioChunks.push(event.data);
          }
        };
        
        mediaRecorder.onstop = function() {
          var mimeType = mediaRecorder.mimeType || 'audio/webm';
          recordedBlob = new Blob(audioChunks, { type: mimeType });
          
          // Save to recordings array
          var recording = {
            id: Date.now(),
            blob: recordedBlob,
            duration: recordingSeconds,
            type: recordType,
            quality: recordQuality,
            timestamp: new Date(),
            url: URL.createObjectURL(recordedBlob)
          };
          recordings.unshift(recording);
          
          // Update complete screen
          showRecordingComplete(recording);
        };
        
        // Start recording
        mediaRecorder.start(1000);
        startRecordingUI();
        showHomeToast('üéôÔ∏è Recording started');
        
      } catch (err) {
        console.error('Error starting recording:', err);
        
        // FALLBACK: Demo mode when permission denied (e.g., in iframe)
        if (err.name === 'NotAllowedError' || err.name === 'NotFoundError') {
          showHomeToast('‚ö†Ô∏è Demo mode (download file for real recording)');
          startDemoRecording();
        } else {
          showHomeToast('‚ùå Could not start recording');
        }
      }
    }
    
    // Demo recording fallback for iframe/permission issues
    function startDemoRecording() {
      isRecording = true;
      isDemoMode = true;
      startRecordingUI();
    }
    
    var isDemoMode = false;
    
    function startRecordingUI() {
      isRecording = true;
      isPaused = false;
      recordingSeconds = 0;
      uploadProgress = 0;
      
      // Update UI
      document.getElementById('recorderSetup').style.display = 'none';
      document.getElementById('recorderActive').style.display = 'block';
      document.getElementById('recorderComplete').style.display = 'none';
      
      if (recordType === 'audio') {
        document.getElementById('waveformContainer').style.display = 'flex';
        document.getElementById('videoPreview').style.display = 'none';
        document.getElementById('recTypeDisplay').textContent = 'Audio';
      } else {
        document.getElementById('waveformContainer').style.display = 'none';
        document.getElementById('videoPreview').style.display = 'flex';
        document.getElementById('recTypeDisplay').textContent = 'Video';
      }
      
      document.getElementById('recQualityDisplay').textContent = recordQuality.charAt(0).toUpperCase() + recordQuality.slice(1);
      
      // Update Dynamic Island
      document.getElementById('island').classList.add('trip-active');
      document.getElementById('island').classList.remove('expanded');
      document.querySelector('.island-icon').textContent = 'üéôÔ∏è';
      document.querySelector('.island-icon').style.background = '#FF375F';
      document.querySelector('.island-title').textContent = isDemoMode ? 'Demo Recording' : 'Recording';
      document.querySelector('.island-title').style.color = '#FF375F';
      document.querySelector('.island-sub').textContent = '00:00 ‚Ä¢ ' + recordType;
      
      // Start timer
      updateRecordingTimer();
      recordingInterval = setInterval(function() {
        if (!isPaused && isRecording) {
          recordingSeconds++;
          updateRecordingTimer();
          updateRecordingSize();
          simulateUpload();
          document.querySelector('.island-sub').textContent = formatRecTime(recordingSeconds) + ' ‚Ä¢ ' + recordType;
        }
      }, 1000);
      
      if (stealthMode) {
        document.querySelector('#recordScreen .screen-header').style.opacity = '0.1';
      }
      
      try { navigator.vibrate(100); } catch(e) {}
    }
    
    function formatRecTime(seconds) {
      var mins = Math.floor(seconds / 60);
      var secs = seconds % 60;
      return String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');
    }
    
    function updateRecordingTimer() {
      document.getElementById('recordingTimer').textContent = formatRecTime(recordingSeconds);
    }
    
    function updateRecordingSize() {
      var bytesPerSec;
      if (recordQuality === 'low') bytesPerSec = 4000;
      else if (recordQuality === 'medium') bytesPerSec = 16000;
      else bytesPerSec = 32000;
      
      if (recordType === 'video') bytesPerSec *= 10;
      
      var totalBytes = recordingSeconds * bytesPerSec;
      var display;
      if (totalBytes < 1024) {
        display = totalBytes + ' B';
      } else if (totalBytes < 1024 * 1024) {
        display = Math.round(totalBytes / 1024) + ' KB';
      } else {
        display = (totalBytes / (1024 * 1024)).toFixed(1) + ' MB';
      }
      document.getElementById('recSizeDisplay').textContent = display;
    }
    
    function simulateUpload() {
      if (document.getElementById('autoUpload').checked) {
        uploadProgress = Math.min(100, uploadProgress + 5);
        document.getElementById('uploadProgressBar').style.width = uploadProgress + '%';
        
        if (uploadProgress >= 100) {
          document.getElementById('uploadStatus').innerHTML = 
            '<div class="upload-icon">‚úÖ</div><span>Backed up to cloud</span>';
        }
      }
    }
    
    function togglePauseRecording() {
      isPaused = !isPaused;
      var btn = document.getElementById('pauseBtn');
      var waveform = document.querySelector('.waveform');
      
      if (isPaused) {
        if (mediaRecorder && mediaRecorder.state === 'recording') {
          mediaRecorder.pause();
        }
        btn.classList.add('active');
        btn.innerHTML = '<span>‚ñ∂Ô∏è</span><span>Resume</span>';
        waveform.classList.add('paused');
        document.querySelector('.rec-dot').style.animationPlayState = 'paused';
        showHomeToast('‚è∏ Recording paused');
      } else {
        if (mediaRecorder && mediaRecorder.state === 'paused') {
          mediaRecorder.resume();
        }
        btn.classList.remove('active');
        btn.innerHTML = '<span>‚è∏</span><span>Pause</span>';
        waveform.classList.remove('paused');
        document.querySelector('.rec-dot').style.animationPlayState = 'running';
        showHomeToast('‚ñ∂Ô∏è Recording resumed');
      }
      
      try { navigator.vibrate(50); } catch(e) {}
    }
    
    function stopRecording() {
      isRecording = false;
      
      if (recordingInterval) {
        clearInterval(recordingInterval);
        recordingInterval = null;
      }
      
      // If real recording, stop media recorder
      if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
        
        if (audioStream) {
          audioStream.getTracks().forEach(function(track) {
            track.stop();
          });
        }
      } else {
        // Demo mode - create a fake recording entry
        var recording = {
          id: Date.now(),
          blob: null,
          duration: recordingSeconds,
          type: recordType,
          quality: recordQuality,
          timestamp: new Date(),
          url: null,
          isDemo: true
        };
        recordings.unshift(recording);
        showRecordingComplete(recording);
      }
      
      document.getElementById('island').classList.remove('trip-active');
      document.querySelector('.island-icon').style.background = '#FF375F';
      document.querySelector('.island-title').style.color = '#FF375F';
      document.querySelector('#recordScreen .screen-header').style.opacity = '1';
      
      isDemoMode = false;
      try { navigator.vibrate([50, 30, 50]); } catch(e) {}
    }
    
    function showRecordingComplete(recording) {
      var sizeDisplay = '0 KB';
      var isDemo = recording && recording.isDemo;
      
      if (recording && recording.blob) {
        var bytes = recording.blob.size;
        if (bytes < 1024) {
          sizeDisplay = bytes + ' B';
        } else if (bytes < 1024 * 1024) {
          sizeDisplay = Math.round(bytes / 1024) + ' KB';
        } else {
          sizeDisplay = (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
      } else if (recording) {
        // Estimate size for demo
        var bytesPerSec = recordQuality === 'low' ? 4000 : (recordQuality === 'medium' ? 16000 : 32000);
        var totalBytes = recordingSeconds * bytesPerSec;
        if (totalBytes < 1024) {
          sizeDisplay = totalBytes + ' B';
        } else if (totalBytes < 1024 * 1024) {
          sizeDisplay = Math.round(totalBytes / 1024) + ' KB';
        } else {
          sizeDisplay = (totalBytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        if (isDemo) sizeDisplay += ' (demo)';
      }
      
      document.getElementById('completeDuration').textContent = formatRecTime(recordingSeconds);
      document.getElementById('completeSize').textContent = sizeDisplay;
      document.getElementById('completePreviewIcon').textContent = recordType === 'audio' ? 'üé§' : 'üìπ';
      
      document.getElementById('recorderActive').style.display = 'none';
      document.getElementById('recorderComplete').style.display = 'block';
      
      addToRecordingsListUI(recording);
      
      if (isDemo) {
        showHomeToast('‚úÖ Demo saved! Download file for real recording');
      } else {
        showHomeToast('‚úÖ Recording saved!');
      }
    }
    
    function addToRecordingsListUI(recording) {
      var newItem = document.createElement('div');
      newItem.className = 'recording-item';
      newItem.setAttribute('data-id', recording ? recording.id : Date.now());
      newItem.innerHTML = 
        '<div class="recording-icon ' + recordType + '">' + (recordType === 'audio' ? 'üé§' : 'üìπ') + '</div>' +
        '<div class="recording-info">' +
          '<div class="recording-name">' + (recordType === 'audio' ? 'Audio' : 'Video') + ' Recording</div>' +
          '<div class="recording-meta">Just now ‚Ä¢ ' + formatRecTime(recordingSeconds) + '</div>' +
        '</div>' +
        '<div class="recording-status uploaded">‚òÅÔ∏è</div>' +
        '<div class="recording-actions">' +
          '<span onclick="playRecording(' + (recording ? recording.id : 0) + ')">‚ñ∂Ô∏è</span>' +
          '<span onclick="shareRecording(' + (recording ? recording.id : 0) + ')">üì§</span>' +
        '</div>';
      
      var list = document.getElementById('recordingsList');
      list.insertBefore(newItem, list.firstChild);
      
      while (list.children.length > 5) {
        list.removeChild(list.lastChild);
      }
    }
    
    function sendRecordingNow() {
      showHomeToast('üì§ Recording sent to 3 contacts');
      try { navigator.vibrate(50); } catch(e) {}
    }
    
    function sendToContacts() {
      var sentStatus = document.getElementById('sentStatus');
      sentStatus.style.display = 'flex';
      sentStatus.className = 'status-item success';
      showHomeToast('üì§ Recording sent to emergency contacts');
      try { navigator.vibrate([50, 30, 50]); } catch(e) {}
    }
    
    function newRecording() {
      recordingSeconds = 0;
      uploadProgress = 0;
      isPaused = false;
      isDemoMode = false;
      audioChunks = [];
      recordedBlob = null;
      mediaRecorder = null;
      
      document.getElementById('recorderSetup').style.display = 'block';
      document.getElementById('recorderActive').style.display = 'none';
      document.getElementById('recorderComplete').style.display = 'none';
      
      document.getElementById('uploadStatus').innerHTML = 
        '<div class="upload-icon">‚òÅÔ∏è</div>' +
        '<span>Uploading to secure cloud...</span>' +
        '<div class="upload-progress"><div class="upload-progress-bar" id="uploadProgressBar"></div></div>';
      
      var btn = document.getElementById('pauseBtn');
      btn.classList.remove('active');
      btn.innerHTML = '<span>‚è∏</span><span>Pause</span>';
      document.querySelector('.waveform').classList.remove('paused');
      document.getElementById('sentStatus').style.display = 'none';
    }
    
    function playRecording(id) {
      var recording = recordings.find(function(r) { return r.id === id; });
      
      if (recording && recording.isDemo) {
        showHomeToast('‚ö†Ô∏è Demo recording - download file for real audio');
        return;
      }
      
      if (recording && recording.url) {
        var audio = new Audio(recording.url);
        audio.play();
        showHomeToast('‚ñ∂Ô∏è Playing recording...');
      } else if (recordings.length > 0 && recordings[0].url) {
        var audio = new Audio(recordings[0].url);
        audio.play();
        showHomeToast('‚ñ∂Ô∏è Playing recording...');
      } else {
        showHomeToast('‚ö†Ô∏è Demo mode - download file for real audio');
      }
    }
    
    function playLastRecording() {
      if (recordings.length > 0) {
        if (recordings[0].isDemo) {
          showHomeToast('‚ö†Ô∏è Demo recording - download file for real audio');
          return;
        }
        if (recordings[0].url) {
          var audio = new Audio(recordings[0].url);
          audio.play();
          showHomeToast('‚ñ∂Ô∏è Playing recording...');
          return;
        }
      }
      
      if (recordedBlob) {
        var url = URL.createObjectURL(recordedBlob);
        var audio = new Audio(url);
        audio.play();
        showHomeToast('‚ñ∂Ô∏è Playing recording...');
      } else {
        showHomeToast('‚ö†Ô∏è Demo mode - download file for real audio');
      }
    }
    
    function shareRecording(id) {
      var recording = recordings.find(function(r) { return r.id === id; });
      
      if (recording && recording.blob && navigator.share) {
        var file = new File([recording.blob], 'safealert-recording.webm', { type: recording.blob.type });
        navigator.share({
          title: 'SafeAlert Recording',
          text: 'Emergency recording from SafeAlert',
          files: [file]
        }).then(function() {
          showHomeToast('üì§ Recording shared');
        }).catch(function(err) {
          showHomeToast('Share cancelled');
        });
      } else {
        showHomeToast('üì§ Share options opened');
      }
    }
    
    function viewAllRecordings() {
      showHomeToast('All recordings: ' + recordings.length + ' saved');
    }
    
    // =============================================
    // REPORT INCIDENT
    // =============================================
    var selectedIncidentType = '';
    var selectedSeverity = 'medium';
    var selectedLocation = '';
    var isLocationCurrent = false;
    var attachedEvidence = [];
    
    var incidentLabels = {
      kidnapping: 'Kidnapping/Abduction',
      terrorist: 'Terrorist Activity',
      gunmen: 'Gunmen/Bandits',
      onechance: 'One Chance',
      missing: 'Missing Person',
      checkpoint: 'Illegal Checkpoint',
      cultist: 'Cultist/Gang Activity',
      robbery: 'Armed Robbery',
      herdsmen: 'Herdsmen Attack',
      explosion: 'Explosion/IED',
      shooting: 'Shooting',
      other: 'Other Threat'
    };
    
    var incidentIcons = {
      kidnapping: 'üö®',
      terrorist: 'üí£',
      gunmen: 'üî´',
      onechance: 'üöê',
      missing: 'üîç',
      checkpoint: 'üöß',
      cultist: '‚öîÔ∏è',
      robbery: 'üí∞',
      herdsmen: 'üêÑ',
      explosion: 'üí•',
      shooting: 'üéØ',
      other: 'üìù'
    };
    
    function selectIncidentType(type, element) {
      selectedIncidentType = type;
      
      document.querySelectorAll('.incident-type').forEach(function(el) {
        el.classList.remove('selected');
      });
      element.classList.add('selected');
      
      try { navigator.vibrate(30); } catch(e) {}
    }
    
    function selectSeverity(level, element) {
      selectedSeverity = level;
      
      document.querySelectorAll('.severity-option').forEach(function(el) {
        el.classList.remove('selected');
      });
      element.classList.add('selected');
      
      try { navigator.vibrate(30); } catch(e) {}
    }
    
    function useCurrentLocation() {
      var locationEl = document.querySelector('.location-current');
      var labelEl = document.getElementById('currentLocationLabel');
      var addressEl = document.getElementById('currentLocationAddress');
      var checkEl = document.getElementById('locationCheck');
      var manualInput = document.getElementById('manualLocation');
      
      // Show loading state
      labelEl.textContent = 'Detecting location...';
      addressEl.textContent = 'Please wait';
      
      // Simulate geolocation (in real app would use navigator.geolocation)
      setTimeout(function() {
        // Simulated location for Lagos
        var locations = [
          'Computer Village, Ikeja',
          'Yaba Bus Stop, Yaba',
          'Oshodi Under Bridge, Oshodi',
          'Victoria Island',
          'Lekki Phase 1',
          'Maryland Mall, Maryland'
        ];
        var randomLocation = locations[Math.floor(Math.random() * locations.length)];
        
        selectedLocation = randomLocation;
        isLocationCurrent = true;
        
        labelEl.textContent = 'Current Location';
        addressEl.textContent = randomLocation;
        locationEl.classList.add('selected');
        checkEl.style.display = 'block';
        manualInput.value = '';
        
        showHomeToast('üìç Location detected');
        try { navigator.vibrate(50); } catch(e) {}
      }, 1000);
    }
    
    function onManualLocationInput() {
      var manualInput = document.getElementById('manualLocation');
      var locationEl = document.querySelector('.location-current');
      var checkEl = document.getElementById('locationCheck');
      
      if (manualInput.value.trim()) {
        selectedLocation = manualInput.value.trim();
        isLocationCurrent = false;
        locationEl.classList.remove('selected');
        checkEl.style.display = 'none';
      }
    }
    
    function attachPhoto() {
      // Simulate photo attachment
      var fileId = Date.now();
      attachedEvidence.push({ id: fileId, type: 'photo', name: 'photo_' + fileId + '.jpg' });
      updateAttachedFiles();
      showHomeToast('üì∑ Photo attached');
    }
    
    function attachRecording() {
      // Check if we have any recordings
      if (recordings.length > 0) {
        var fileId = Date.now();
        attachedEvidence.push({ id: fileId, type: 'audio', name: 'recording.webm' });
        updateAttachedFiles();
        showHomeToast('üéôÔ∏è Recording attached');
      } else {
        showHomeToast('No recordings available. Record first!');
      }
    }
    
    function attachVideo() {
      var fileId = Date.now();
      attachedEvidence.push({ id: fileId, type: 'video', name: 'video_' + fileId + '.mp4' });
      updateAttachedFiles();
      showHomeToast('üìπ Video attached');
    }
    
    function updateAttachedFiles() {
      var container = document.getElementById('attachedFiles');
      
      if (attachedEvidence.length === 0) {
        container.style.display = 'none';
        return;
      }
      
      container.style.display = 'flex';
      container.innerHTML = attachedEvidence.map(function(file) {
        var icon = file.type === 'photo' ? 'üì∑' : (file.type === 'audio' ? 'üéôÔ∏è' : 'üìπ');
        return '<div class="attached-file">' +
          '<span>' + icon + '</span>' +
          '<span>' + file.name + '</span>' +
          '<span class="attached-file-remove" onclick="removeAttachment(' + file.id + ')">‚úï</span>' +
        '</div>';
      }).join('');
    }
    
    function removeAttachment(id) {
      attachedEvidence = attachedEvidence.filter(function(f) { return f.id !== id; });
      updateAttachedFiles();
    }
    
    function submitReport() {
      // Validate
      if (!selectedIncidentType) {
        showHomeToast('‚ö†Ô∏è Please select threat type');
        return;
      }
      
      if (!selectedLocation && !document.getElementById('manualLocation').value) {
        showHomeToast('‚ö†Ô∏è Please add a location');
        return;
      }
      
      var description = document.getElementById('reportDescription').value.trim();
      var isAnonymous = document.getElementById('anonymousToggle').checked;
      var location = selectedLocation || document.getElementById('manualLocation').value;
      
      // Update submitted card
      document.getElementById('submittedTypeIcon').textContent = incidentIcons[selectedIncidentType];
      document.getElementById('submittedType').textContent = incidentLabels[selectedIncidentType];
      document.getElementById('submittedLocation').textContent = location;
      document.getElementById('submittedDesc').textContent = description || 'No additional details provided.';
      
      var severityEl = document.getElementById('submittedSeverity');
      var urgencyLabels = { low: 'Past', medium: 'Active', high: 'DANGER' };
      severityEl.textContent = urgencyLabels[selectedSeverity];
      severityEl.className = 'submitted-severity ' + selectedSeverity;
      
      document.getElementById('submittedAnon').textContent = isAnonymous ? 'üé≠ Anonymous' : 'üë§ Identified';
      
      // Show submitted state
      document.getElementById('reportForm').style.display = 'none';
      document.getElementById('reportSubmitted').style.display = 'block';
      
      // Update Dynamic Island
      document.getElementById('island').classList.add('expanded');
      document.querySelector('.island-icon').textContent = 'üö®';
      document.querySelector('.island-icon').style.background = '#FF375F';
      document.querySelector('.island-title').textContent = 'Alert Sent';
      document.querySelector('.island-title').style.color = '#FF375F';
      document.querySelector('.island-sub').textContent = 'Notifying authorities';
      
      setTimeout(function() {
        document.getElementById('island').classList.remove('expanded');
      }, 3000);
      
      try { navigator.vibrate([50, 30, 50, 30, 50]); } catch(e) {}
      showHomeToast('üö® Security alert submitted!');
    }
    
    function shareReport() {
      var location = selectedLocation || document.getElementById('manualLocation').value || 'Unknown location';
      var urgency = selectedSeverity === 'high' ? 'üî¥ DANGER' : (selectedSeverity === 'medium' ? 'üü† ACTIVE' : 'üü° REPORTED');
      var text = 'üö® SECURITY ALERT - ' + urgency + ' üö®\n\n' +
        '‚ö†Ô∏è ' + incidentLabels[selectedIncidentType] + '\n' +
        'üìç ' + location + '\n\n' +
        'Please share to keep others safe!\n' +
        'Report incidents via SafeAlert NG';
      
      if (navigator.share) {
        navigator.share({
          title: 'SafeAlert NG - Security Alert',
          text: text
        }).catch(function() {});
      } else {
        // Fallback: copy to clipboard
        navigator.clipboard.writeText(text).then(function() {
          showHomeToast('üìã Copied to clipboard');
        });
      }
    }
    
    function newReport() {
      // Reset form
      selectedIncidentType = '';
      selectedSeverity = 'medium';
      selectedLocation = '';
      isLocationCurrent = false;
      attachedEvidence = [];
      
      document.querySelectorAll('.incident-type').forEach(function(el) {
        el.classList.remove('selected');
      });
      
      document.querySelectorAll('.severity-option').forEach(function(el) {
        el.classList.remove('selected');
      });
      document.querySelector('.severity-option.medium').classList.add('selected');
      
      document.querySelector('.location-current').classList.remove('selected');
      document.getElementById('currentLocationLabel').textContent = 'Use Current Location';
      document.getElementById('currentLocationAddress').textContent = 'Tap to detect your location';
      document.getElementById('locationCheck').style.display = 'none';
      document.getElementById('manualLocation').value = '';
      
      document.getElementById('reportDescription').value = '';
      document.getElementById('anonymousToggle').checked = true;
      document.getElementById('attachedFiles').style.display = 'none';
      
      // Show form
      document.getElementById('reportForm').style.display = 'block';
      document.getElementById('reportSubmitted').style.display = 'none';
    }
    
    // =============================================
    // SOS VARIABLES
    // =============================================
    var countdown = 3;
    var timer = null;
    var holding = false;
    var emergency = false;
    
    // =============================================
    // SOS FUNCTIONS
    // =============================================
    function startSOS() {
      if (emergency || holding) return;
      holding = true;
      countdown = 3;
      
      document.getElementById('glow').classList.add('danger');
      document.getElementById('sosBtn').classList.add('holding');
      document.getElementById('sosCount').textContent = countdown;
      document.getElementById('sosLabel').textContent = 'Release to cancel';
      
      timer = setInterval(function() {
        countdown--;
        document.getElementById('sosCount').textContent = countdown;
        try { navigator.vibrate(100); } catch(e) {}
        
        if (countdown <= 0) {
          clearInterval(timer);
          timer = null;
          triggerEmergency();
        }
      }, 1000);
    }
    
    function stopSOS() {
      if (!holding || emergency) return;
      holding = false;
      
      if (timer) {
        clearInterval(timer);
        timer = null;
      }
      
      document.getElementById('glow').classList.remove('danger');
      document.getElementById('sosBtn').classList.remove('holding');
      document.getElementById('sosCount').textContent = 'SOS';
      document.getElementById('sosLabel').textContent = 'Hold for 3 seconds';
    }
    
    function endEmergency() {
      emergency = false;
      holding = false;
      
      // Close modal
      document.getElementById('modal').classList.remove('show');
      
      // Hide End Emergency button
      document.getElementById('endEmergencyBtn2').style.display = 'none';
      
      // Reset glow
      document.getElementById('glow').classList.remove('danger');
      
      // Reset Dynamic Island
      document.getElementById('island').classList.remove('expanded');
      document.querySelector('.island-icon').textContent = 'üõ°Ô∏è';
      document.querySelector('.island-icon').style.background = '#FF375F';
      document.querySelector('.island-title').textContent = 'SafeAlert';
      document.querySelector('.island-title').style.color = '#FF375F';
      document.querySelector('.island-sub').textContent = 'Protection Active';
      
      // Reset safety card
      document.getElementById('safety').classList.remove('danger');
      document.getElementById('safetyIcon').textContent = '‚úì';
      document.getElementById('safetyTitle').textContent = 'You\'re Protected';
      document.getElementById('safetySub').textContent = '3 emergency contacts ready';
      document.getElementById('safetyBadge').textContent = 'üü¢ All Systems Active';
      
      // Reset SOS button
      document.getElementById('sosBtn').classList.remove('holding', 'triggered');
      document.getElementById('sosCount').textContent = 'SOS';
      document.getElementById('sosLabel').textContent = 'Hold for 3 seconds';
      
      // Notify contacts that user is safe
      showHomeToast('‚úÖ Emergency ended - Contacts notified you\'re safe');
      try { navigator.vibrate([50, 30, 50]); } catch(e) {}
    }
    
    function onSafetyCardTap() {
      if (emergency) {
        // Show confirmation before ending emergency
        if (confirm('End emergency and notify contacts you\'re safe?')) {
          endEmergency();
        }
      }
    }
    
    function triggerEmergency() {
      emergency = true;
      holding = false;
      
      document.getElementById('sosBtn').classList.remove('holding');
      document.getElementById('sosBtn').classList.add('triggered');
      document.getElementById('sosCount').textContent = 'üö®';
      document.getElementById('sosLabel').textContent = 'BROADCASTING';
      
      // Show End Emergency button
      document.getElementById('endEmergencyBtn2').style.display = 'flex';
      
      document.getElementById('glow').classList.add('danger');
      document.getElementById('island').classList.remove('trip-active');
      document.getElementById('island').classList.add('expanded');
      document.querySelector('.island-icon').textContent = 'üö®';
      document.querySelector('.island-title').textContent = 'Emergency Active';
      document.querySelector('.island-sub').textContent = 'Help is on the way';
      
      document.getElementById('safety').classList.add('danger');
      document.getElementById('safetyIcon').textContent = 'üö®';
      document.getElementById('safetyTitle').textContent = 'Emergency Active';
      document.getElementById('safetySub').textContent = 'Help is on the way ‚Ä¢ Live tracking';
      document.getElementById('safetyBadge').textContent = 'üî¥ Broadcasting';
      
      document.getElementById('modalBox').innerHTML = 
        '<div class="modal-icon">‚úÖ</div>' +
        '<div class="modal-title">Alert Sent!</div>' +
        '<div class="modal-text">GPS location sent to:</div>' +
        '<div class="sent"><span class="sent-icon">üì±</span><div><div class="sent-name">Mama</div><div class="sent-status">‚úì SMS + Call</div></div></div>' +
        '<div class="sent"><span class="sent-icon">üè†</span><div><div class="sent-name">Alhaji Danfodio</div><div class="sent-status">‚úì SMS sent</div></div></div>' +
        '<div class="sent"><span class="sent-icon">üõ°Ô∏è</span><div><div class="sent-name">Area Security</div><div class="sent-status">‚úì SMS sent</div></div></div>' +
        '<button class="modal-btn done" id="doneBtn">Continue Tracking</button>' +
        '<button class="modal-btn end-emergency" id="endEmergencyBtn">I\'m Safe - End Emergency</button>';
      
      document.getElementById('modal').classList.add('show');
      
      document.getElementById('doneBtn').onclick = function() {
        document.getElementById('modal').classList.remove('show');
      };
      
      document.getElementById('endEmergencyBtn').onclick = function() {
        endEmergency();
      };
      
      try { navigator.vibrate([200, 100, 200, 100, 200]); } catch(e) {}
    }
    
    // =============================================
    // ATTACH SOS EVENTS
    // =============================================
    var btn = document.getElementById('sosBtn');
    btn.addEventListener('pointerdown', function(e) {
      e.preventDefault();
      btn.setPointerCapture(e.pointerId);
      startSOS();
    });
    btn.addEventListener('pointerup', function(e) { e.preventDefault(); stopSOS(); });
    btn.addEventListener('pointercancel', function(e) { e.preventDefault(); stopSOS(); });
    btn.addEventListener('contextmenu', function(e) { e.preventDefault(); });
    
    // Region pills
    document.querySelectorAll('.region-pill').forEach(function(pill) {
      pill.addEventListener('click', function() {
        document.querySelectorAll('.region-pill').forEach(function(p) { p.classList.remove('active'); });
        this.classList.add('active');
      });
    });
    
    // =============================================
    // AUTO LOCATION SHARE ON SOS
    // =============================================
    var originalTriggerEmergency = triggerEmergency;
    triggerEmergency = function() {
      // Start auto-recording
      if (typeof startRecording === 'function' && !isRecording) {
        setTimeout(function() {
          startRecording();
        }, 500);
      }
      
      // Call original function
      originalTriggerEmergency();
      
      // Auto-share location
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(pos) {
          var lat = pos.coords.latitude;
          var lng = pos.coords.longitude;
          console.log('SOS Location: ' + lat + ', ' + lng);
          // In real app: Send to server/contacts
        });
      }
    };
    
    console.log('SafeAlert loaded!');
    
    // =============================================
    // PWA SERVICE WORKER REGISTRATION
    // =============================================
    
    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw.js')
          .then(function(registration) {
            console.log('‚úÖ ServiceWorker registered:', registration.scope);
          })
          .catch(function(error) {
            console.log('‚ùå ServiceWorker registration failed:', error);
          });
      });
    }
    
    // PWA Install Prompt
    var deferredPrompt = null;
    
    window.addEventListener('beforeinstallprompt', function(e) {
      // Prevent Chrome 67+ from automatically showing the prompt
      e.preventDefault();
      // Stash the event so it can be triggered later
      deferredPrompt = e;
      
      // Show install button/banner
      showInstallPrompt();
    });
    
    function showInstallPrompt() {
      // Create install banner
      var banner = document.createElement('div');
      banner.id = 'installBanner';
      banner.style.cssText = 'position:fixed;bottom:100px;left:20px;right:20px;background:linear-gradient(135deg,#1C1C1E,#2C2C2E);border:1px solid rgba(255,55,95,0.3);border-radius:20px;padding:16px 20px;display:flex;align-items:center;gap:14px;z-index:200;box-shadow:0 10px 40px rgba(0,0,0,0.5);animation:slideUp 0.3s ease;';
      
      banner.innerHTML = 
        '<div style="font-size:32px;">üì≤</div>' +
        '<div style="flex:1;">' +
          '<div style="font-weight:700;font-size:15px;margin-bottom:2px;">Install SafeAlert</div>' +
          '<div style="font-size:12px;color:#8E8E93;">Add to home screen for quick access</div>' +
        '</div>' +
        '<button id="installBtn" style="background:#FF375F;border:none;border-radius:12px;padding:10px 16px;color:#fff;font-weight:700;font-size:14px;cursor:pointer;">Install</button>' +
        '<button id="dismissInstall" style="background:none;border:none;color:#636366;font-size:20px;cursor:pointer;padding:4px;">‚úï</button>';
      
      document.body.appendChild(banner);
      
      // Install button click
      document.getElementById('installBtn').addEventListener('click', function() {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then(function(choiceResult) {
            if (choiceResult.outcome === 'accepted') {
              console.log('‚úÖ User installed the app');
              showHomeToast('‚úÖ SafeAlert installed!');
            }
            deferredPrompt = null;
            banner.remove();
          });
        }
      });
      
      // Dismiss button click
      document.getElementById('dismissInstall').addEventListener('click', function() {
        banner.remove();
        // Remember dismissal for this session
        sessionStorage.setItem('installDismissed', 'true');
      });
    }
    
    // Check if already installed
    window.addEventListener('appinstalled', function() {
      console.log('‚úÖ SafeAlert was installed');
      deferredPrompt = null;
      var banner = document.getElementById('installBanner');
      if (banner) banner.remove();
    });
    
    // Detect if running as PWA
    if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
      console.log('üì± Running as installed PWA');
      document.body.classList.add('pwa-mode');
    }
  </script>
</body>
</html>
